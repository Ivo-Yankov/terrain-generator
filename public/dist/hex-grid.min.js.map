{"version":3,"sources":["vg.js","Board.js","grids/Cell.js","grids/HexGrid.js","grids/SqrGrid.js","grids/Tile.js","lib/LinkedList.js","lib/Signal.js","utils/Loader.js","utils/MouseCaster.js","utils/Scene.js","utils/SelectionManager.js","utils/Tools.js","pathing/AStarFinder.js","pathing/PathUtil.js"],"names":["vg","VERSION","PI","Math","TAU","DEG_TO_RAD","RAD_TO_DEG","SQRT3","sqrt","TILE","ENT","STR","HEX","SQR","ABS","Board","grid","finderConfig","Error","this","tiles","tileGroup","group","THREE","Object3D","overlay","finder","AStarFinder","Loader","init","setGrid","prototype","setEntityOnTile","entity","tile","pos","cellToPixel","cell","position","copy","y","heightOffset","addTile","i","indexOf","push","snapTileToGrid","add","mesh","removeTile","remove","splice","dispose","removeAllTiles","children","length","getTileAtCell","h","cellToHash","cells","snapToGrid","pixelToCell","getRandomTile","Tools","randomInt","findPath","startTile","endTile","heuristic","maxDistance","newGrid","forEach","t","generateOverlay","size","mat","LineBasicMaterial","color","opacity","generateTilemap","config","reset","generateTiles","constructor","Cell","q","r","s","userData","walkable","_calcCost","_priority","_visited","_parent","uniqueID","LinkedList","generateID","set","equals","HexGrid","type","cellSize","numCells","extrudeSettings","autogenerated","verts","_createVertex","cellShape","Shape","moveTo","x","lineTo","autoClose","cellGeo","Geometry","vertices","verticesNeedUpdate","cellShapeGeo","ShapeGeometry","_cellWidth","_cellLength","_hashDelimeter","_directions","_diagonals","_list","_vec3","Vector3","_cel","_conversionVec","_geoCache","_matCache","TWO_THIRDS","z","_cubeRound","getCellAt","getNeighbors","diagonal","filter","n","l","getRandomCell","c","distance","cellA","cellB","d","max","abs","clearPath","traverse","cb","generateTile","scale","material","height","geo","amount","ExtrudeGeometry","Tile","geometry","settings","tileScale","bevelEnabled","bevelSegments","steps","bevelSize","bevelThickness","merge","generateTilePoly","MeshBasicMaterial","Mesh","rotateOnAxis","generate","overlayObj","overlayMat","createPointsGeometry","line","Line","rotation","load","url","scope","self","getJSON","callback","json","fromJSON","call","cache","toJSON","k","angle","cos","sin","rx","round","ry","rz","xDiff","yDiff","zDiff","SqrGrid","_fullCellSize","half","ceil","MeshPhongMaterial","randomizeRGB","objectType","selected","highlight","structure","emissive","_emissive","getHex","select","setHex","deselect","toggle","parent","LinkedListNode","obj","next","prev","free","first","last","objToNodeMap","Date","now","floor","random","sortArray","toString","slice","getNode","addNode","node","err","console","error","swapObjects","newObj","showDebug","dump","has","moveUp","b","a","oldCNext","moveDown","sort","compare","clear","shift","pop","concat","list","msg","log","SignalBinding","signal","listener","isOnce","listenerContext","priority","_listener","context","active","params","execute","paramsArr","handlerReturn","apply","detach","isBound","_destroy","Signal","_bindings","_prevParams","dispatch","arguments","memorize","_shouldPropagate","validateListener","fnName","replace","_registerListener","binding","prevIndex","_indexOfListener","_addBinding","cur","addOnce","removeAll","getNumListeners","halt","bindings","Array","forget","manager","imageLoader","crossOrigin","LoadingManager","warn","ImageLoader","loadTexture","mapping","onLoad","onError","texture","Texture","image","needsUpdate","evt","sourceFile","MouseCaster","camera","element","down","rightDown","pickedObject","selectedObject","allHits","ctrl","wheel","screenPosition","Vector2","_camera","_raycaster","Raycaster","_preventDefault","document","addEventListener","_onDocumentMouseMove","bind","_onDocumentMouseDown","_onDocumentMouseUp","_onMouseWheel","OVER","OUT","DOWN","UP","CLICK","WHEEL","update","setFromCamera","hit","intersects","intersectObject","object","point","preventDefault","window","event","shiftKey","ctrlKey","which","clientX","innerWidth","clientY","innerHeight","stopPropagation","delta","undefined","wheelDelta","detail","Scene","sceneConfig","controlConfig","sceneSettings","body","alpha","antialias","clearColor","sortObjects","fog","light","DirectionalLight","lightPosition","cameraType","cameraPosition","orthoZoom","controlSettings","minDistance","zoomSpeed","noZoom","renderer","WebGLRenderer","setClearColor","width","container","AmbientLight","normalize","OrthographicCamera","PerspectiveCamera","contolled","controls","OrbitControls","domElement","left","right","top","bottom","aspect","updateProjectionMatrix","setSize","attachTo","style","setPixelRatio","devicePixelRatio","appendChild","render","updateOrthoZoom","focusOn","lookAt","SelectionManager","mouse","onSelect","onDeselect","toggleSelection","onMouse","fireSignal","clearSelection","clamp","val","min","sign","v","getShortRotation","isPlainObject","nodeType","Object","hasOwnProperty","target","src","array","isArray","dst","e","keys","key","nwf","system","Performance","elapsedTime","performance","empty","lastChild","removeChild","radixSort","arr","idxBegin","idxEnd","bit","idx","idxOnes","mask","tmp","base","range","rgb","split","parseInt","substring","xhr","XMLHttpRequest","uri","onreadystatechange","status","JSON","parse","responseText","statusText","open","setRequestHeader","send","allowDiagonal","heuristicFilter","startNode","endNode","current","costSoFar","neighbors","PathUtil","backtrace","nodeA","nodeB","path","reverse","biBacktrace","pathA","pathB","pathLength","dx","dy","sum","interpolate","x0","y0","x1","y1","sx","sy","e2","expandPath","coord0","coord1","interpolated","interpolatedLen","j","expanded","len","smoothenPath","ex","ey","newPath","lastValidCoord","coord","testCoord","blocked","isWalkableAt","compressPath","lx","ly","ldx","ldy","sq","compressed","px","py"],"mappings":"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","file":"hex-grid.min.js","sourcesContent":["var vg = { // eslint-disable-line\n\tVERSION: '0.1.1',\n\n\tPI: Math.PI,\n\tTAU: Math.PI * 2,\n\tDEG_TO_RAD: 0.0174532925,\n\tRAD_TO_DEG: 57.2957795,\n\tSQRT3: Math.sqrt(3), // used often in hex conversions\n\n\t// useful enums for type checking. change to whatever fits your game. these are just examples\n\tTILE: 'tile', // visual representation of a grid cell\n\tENT: 'entity', // dynamic things\n\tSTR: 'structure', // static things\n\n\tHEX: 'hex',\n\tSQR: 'square',\n\tABS: 'abstract'\n};","/*\n\tInterface to the grid. Holds data about the visual representation of the cells (tiles).\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nvg.Board = function(grid, finderConfig) {\n\tif (!grid) throw new Error('You must pass in a grid system for the board to use.');\n\n\tthis.tiles = [];\n\tthis.tileGroup = null; // only for tiles\n\n\tthis.group = new THREE.Object3D(); // can hold all entities, also holds tileGroup, never trashed\n\n\tthis.grid = null;\n\tthis.overlay = null;\n\tthis.finder = new vg.AStarFinder(finderConfig);\n\t// need to keep a resource cache around, so this Loader does that, use it instead of THREE.ImageUtils\n\tvg.Loader.init();\n\n\tthis.setGrid(grid);\n};\n\nvg.Board.prototype = {\n\tsetEntityOnTile: function(entity, tile) {\n\t\t// snap an entity's position to a tile; merely copies position\n\t\tvar pos = this.grid.cellToPixel(tile.cell);\n\t\tentity.position.copy(pos);\n\t\t// adjust for any offset after the entity was set directly onto the tile\n\t\tentity.position.y += entity.heightOffset || 0;\n\t\t// remove entity from old tile\n\t\tif (entity.tile) {\n\t\t\tentity.tile.entity = null;\n\t\t}\n\t\t// set new situation\n\t\tentity.tile = tile;\n\t\ttile.entity = entity;\n\t},\n\n\taddTile: function(tile) {\n\t\tvar i = this.tiles.indexOf(tile);\n\t\tif (i === -1) this.tiles.push(tile);\n\t\telse return;\n\n\t\tthis.snapTileToGrid(tile);\n\t\ttile.position.y = 0;\n\n\t\tthis.tileGroup.add(tile.mesh);\n\t\tthis.grid.add(tile.cell);\n\n\t\ttile.cell.tile = tile;\n\t},\n\n\tremoveTile: function(tile) {\n\t\tif (!tile) return; // was already removed somewhere\n\t\tvar i = this.tiles.indexOf(tile);\n\t\tthis.grid.remove(tile.cell);\n\n\t\tif (i !== -1) this.tiles.splice(i, 1);\n\t\t// this.tileGroup.remove(tile.mesh);\n\n\t\ttile.dispose();\n\t},\n\n\tremoveAllTiles: function() {\n\t\tif (!this.tileGroup) return;\n\t\tvar tiles = this.tileGroup.children;\n\t\tfor (var i = 0; i < tiles.length; i++) {\n\t\t\tthis.tileGroup.remove(tiles[i]);\n\t\t}\n\t},\n\n\tgetTileAtCell: function(cell) {\n\t\tvar h = this.grid.cellToHash(cell);\n\t\treturn cell.tile || (typeof this.grid.cells[h] !== 'undefined' ? this.grid.cells[h].tile : null);\n\t},\n\n\tsnapToGrid: function(pos) {\n\t\tvar cell = this.grid.pixelToCell(pos);\n\t\tpos.copy(this.grid.cellToPixel(cell));\n\t},\n\n\tsnapTileToGrid: function(tile) {\n\t\tif (tile.cell) {\n\t\t\ttile.position.copy(this.grid.cellToPixel(tile.cell));\n\t\t}\n\t\telse {\n\t\t\tvar cell = this.grid.pixelToCell(tile.position);\n\t\t\ttile.position.copy(this.grid.cellToPixel(cell));\n\t\t}\n\t\treturn tile;\n\t},\n\n\tgetRandomTile: function() {\n\t\tvar i = vg.Tools.randomInt(0, this.tiles.length-1);\n\t\treturn this.tiles[i];\n\t},\n\n\tfindPath: function(startTile, endTile, heuristic, maxDistance) {\n\t\treturn this.finder.findPath(startTile.cell, endTile.cell, heuristic, this.grid, maxDistance);\n\t},\n\n\tsetGrid: function(newGrid) {\n\t\tthis.group.remove(this.tileGroup);\n\t\tif (this.grid && newGrid !== this.grid) {\n\t\t\tthis.removeAllTiles();\n\t\t\tthis.tiles.forEach(function(t) {\n\t\t\t\tthis.grid.remove(t.cell);\n\t\t\t\tt.dispose();\n\t\t\t});\n\t\t\tthis.grid.dispose();\n\t\t}\n\t\tthis.grid = newGrid;\n\t\tthis.tiles = [];\n\t\tthis.tileGroup = new THREE.Object3D();\n\t\tthis.group.add(this.tileGroup);\n\t},\n\n\tgenerateOverlay: function(size) {\n\t\tvar mat = new THREE.LineBasicMaterial({\n\t\t\tcolor: 0x000000,\n\t\t\topacity: 0.3\n\t\t});\n\n\t\tif (this.overlay) {\n\t\t\tthis.group.remove(this.overlay);\n\t\t}\n\n\t\tthis.overlay = new THREE.Object3D();\n\n\t\tthis.grid.generateOverlay(size, this.overlay, mat);\n\n\t\tthis.group.add(this.overlay);\n\t},\n\n\tgenerateTilemap: function(config) {\n\t\tthis.reset();\n\n\t\tvar tiles = this.grid.generateTiles(config);\n\t\tthis.tiles = tiles;\n\n\t\tthis.tileGroup = new THREE.Object3D();\n\t\tfor (var i = 0; i < tiles.length; i++) {\n\t\t\tthis.tileGroup.add(tiles[i].mesh);\n\t\t}\n\n\t\tthis.group.add(this.tileGroup);\n\t},\n\n\treset: function() {\n\t\t// removes all tiles from the scene, but leaves the grid intact\n\t\tthis.removeAllTiles();\n\t\tif (this.tileGroup) this.group.remove(this.tileGroup);\n\t}\n};\n\nvg.Board.prototype.constructor = vg.Board;\n","/*\n\tSimple structure for holding grid coordinates and extra data about them.\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n*/\nvg.Cell = function(q, r, s, h) {\n\tthis.q = q || 0; // x grid coordinate (using different letters so that it won't be confused with pixel/world coordinates)\n\tthis.r = r || 0; // y grid coordinate\n\tthis.s = s || 0; // z grid coordinate\n\tthis.h = h || 1; // 3D height of the cell, used by visual representation and pathfinder, cannot be less than 1\n\tthis.tile = null; // optional link to the visual representation's class instance\n\tthis.userData = {}; // populate with any extra data needed in your game\n\tthis.walkable = true; // if true, pathfinder will use as a through node\n\t// rest of these are used by the pathfinder and overwritten at runtime, so don't touch\n\tthis._calcCost = 0;\n\tthis._priority = 0;\n\tthis._visited = false;\n\tthis._parent = null;\n\tthis.uniqueID = vg.LinkedList.generateID();\n};\n\nvg.Cell.prototype = {\n\tset: function(q, r, s) {\n\t\tthis.q = q;\n\t\tthis.r = r;\n\t\tthis.s = s;\n\t\treturn this;\n\t},\n\n\tcopy: function(cell) {\n\t\tthis.q = cell.q;\n\t\tthis.r = cell.r;\n\t\tthis.s = cell.s;\n\t\tthis.h = cell.h;\n\t\tthis.tile = cell.tile || null;\n\t\tthis.userData = cell.userData || {};\n\t\tthis.walkable = cell.walkable;\n\t\treturn this;\n\t},\n\n\tadd: function(cell) {\n\t\tthis.q += cell.q;\n\t\tthis.r += cell.r;\n\t\tthis.s += cell.s;\n\t\treturn this;\n\t},\n\n\tequals: function(cell) {\n\t\treturn this.q === cell.q && this.r === cell.r && this.s === cell.s;\n\t}\n};\n\nvg.Cell.prototype.constructor = vg.Cell;\n","/*\n\tGraph of hexagons. Handles grid cell management (placement math for eg pathfinding, range, etc) and grid conversion math.\n\t[Cube/axial coordinate system](http://www.redblobgames.com/grids/hexagons/), \"flat top\" version only. Since this is 3D, just rotate your camera for pointy top maps.\n\tInterface:\n\ttype\n\tsize - number of cells (in radius); only used if the map is generated\n\tcellSize\n\tcells - a hash so we can have sparse maps\n\tnumCells\n\textrudeSettings\n\tautogenerated\n\tcellShape\n\tcellGeo\n\tcellShapeGeo\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\n// 'utils/Loader', 'graphs/Hex', 'utils/Tools'\nvg.HexGrid = function(config) {\n\tconfig = config || {};\n\t/*  ______________________________________________\n\t\tGRID INTERFACE:\n\t*/\n\tthis.type = vg.HEX;\n\tthis.size = 5; // only used for generated maps\n\tthis.cellSize = typeof config.cellSize === 'undefined' ? 10 : config.cellSize;\n\tthis.cells = {};\n\tthis.numCells = 0;\n\n\tthis.extrudeSettings = null;\n\tthis.autogenerated = false;\n\n\t// create base shape used for building geometry\n\tvar i, verts = [];\n\t// create the skeleton of the hex\n\tfor (i = 0; i < 6; i++) {\n\t\tverts.push(this._createVertex(i));\n\t}\n\t// copy the verts into a shape for the geometry to use\n\tthis.cellShape = new THREE.Shape();\n\tthis.cellShape.moveTo(verts[0].x, verts[0].y);\n\tfor (i = 1; i < 6; i++) {\n\t\tthis.cellShape.lineTo(verts[i].x, verts[i].y);\n\t}\n\tthis.cellShape.lineTo(verts[0].x, verts[0].y);\n\tthis.cellShape.autoClose = true;\n\n\tthis.cellGeo = new THREE.Geometry();\n\tthis.cellGeo.vertices = verts;\n\tthis.cellGeo.verticesNeedUpdate = true;\n\n\tthis.cellShapeGeo = new THREE.ShapeGeometry(this.cellShape);\n\n\t/*  ______________________________________________\n\t\tPRIVATE\n\t*/\n\n\tthis._cellWidth = this.cellSize * 2;\n\tthis._cellLength = (vg.SQRT3 * 0.5) * this._cellWidth;\n\tthis._hashDelimeter = '.';\n\t// pre-computed permutations\n\tthis._directions = [new vg.Cell(+1, -1, 0), new vg.Cell(+1, 0, -1), new vg.Cell(0, +1, -1),\n\t\t\t\t\t\tnew vg.Cell(-1, +1, 0), new vg.Cell(-1, 0, +1), new vg.Cell(0, -1, +1)];\n\tthis._diagonals = [new vg.Cell(+2, -1, -1), new vg.Cell(+1, +1, -2), new vg.Cell(-1, +2, -1),\n\t\t\t\t\t   new vg.Cell(-2, +1, +1), new vg.Cell(-1, -1, +2), new vg.Cell(+1, -2, +1)];\n\t// cached objects\n\tthis._list = [];\n\tthis._vec3 = new THREE.Vector3();\n\tthis._cel = new vg.Cell();\n\tthis._conversionVec = new THREE.Vector3();\n\tthis._geoCache = [];\n\tthis._matCache = [];\n};\n\nvg.HexGrid.TWO_THIRDS = 2 / 3;\n\nvg.HexGrid.prototype = {\n\t/*  ________________________________________________________________________\n\t\tHigh-level functions that the Board interfaces with (all grids implement)\n\t */\n\n\t// grid cell (Hex in cube coordinate space) to position in pixels/world\n\tcellToPixel: function(cell) {\n\t\tthis._vec3.x = cell.q * this._cellWidth * 0.75;\n\t\tthis._vec3.y = cell.h;\n\t\tthis._vec3.z = -((cell.s - cell.r) * this._cellLength * 0.5);\n\t\treturn this._vec3;\n\t},\n\n\tpixelToCell: function(pos) {\n\t\t// convert a position in world space (\"pixels\") to cell coordinates\n\t\tvar q = pos.x * (vg.HexGrid.TWO_THIRDS / this.cellSize);\n\t\tvar r = ((-pos.x / 3) + (vg.SQRT3/3) * pos.z) / this.cellSize;\n\t\tthis._cel.set(q, r, -q-r);\n\t\treturn this._cubeRound(this._cel);\n\t},\n\n\tgetCellAt: function(pos) {\n\t\t// get the Cell (if any) at the passed world position\n\t\tvar q = pos.x * (vg.HexGrid.TWO_THIRDS / this.cellSize);\n\t\tvar r = ((-pos.x / 3) + (vg.SQRT3/3) * pos.z) / this.cellSize;\n\t\tthis._cel.set(q, r, -q-r);\n\t\tthis._cubeRound(this._cel);\n\t\treturn this.cells[this.cellToHash(this._cel)];\n\t},\n\n\tgetNeighbors: function(cell, diagonal, filter) {\n\t\t// always returns an array\n\t\tvar i, n, l = this._directions.length;\n\t\tthis._list.length = 0;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tthis._cel.copy(cell);\n\t\t\tthis._cel.add(this._directions[i]);\n\t\t\tn = this.cells[this.cellToHash(this._cel)];\n\t\t\tif (!n || (filter && !filter(cell, n))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis._list.push(n);\n\t\t}\n\t\tif (diagonal) {\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tthis._cel.copy(cell);\n\t\t\t\tthis._cel.add(this._diagonals[i]);\n\t\t\t\tn = this.cells[this.cellToHash(this._cel)];\n\t\t\t\tif (!n || (filter && !filter(cell, n))) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._list.push(n);\n\t\t\t}\n\t\t}\n\t\treturn this._list;\n\t},\n\n\tgetRandomCell: function() {\n\t\tvar c, i = 0, x = vg.Tools.randomInt(0, this.numCells);\n\t\tfor (c in this.cells) {\n\t\t\tif (i === x) {\n\t\t\t\treturn this.cells[c];\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\treturn this.cells[c];\n\t},\n\n\tcellToHash: function(cell) {\n\t\treturn cell.q+this._hashDelimeter+cell.r+this._hashDelimeter+cell.s;\n\t},\n\n\tdistance: function(cellA, cellB) {\n\t\tvar d = Math.max(Math.abs(cellA.q - cellB.q), Math.abs(cellA.r - cellB.r), Math.abs(cellA.s - cellB.s));\n\t\t// d += cellB.h - cellA.h; // include vertical height\n\t\treturn d;\n\t},\n\n\tclearPath: function() {\n\t\tvar i, c;\n\t\tfor (i in this.cells) {\n\t\t\tc = this.cells[i];\n\t\t\tc._calcCost = 0;\n\t\t\tc._priority = 0;\n\t\t\tc._parent = null;\n\t\t\tc._visited = false;\n\t\t}\n\t},\n\n\ttraverse: function(cb) {\n\t\tvar i;\n\t\tfor (i in this.cells) {\n\t\t\tcb(this.cells[i]);\n\t\t}\n\t},\n\n\tgenerateTile: function(cell, scale, material) {\n\t\tvar height = Math.abs(cell.h);\n\t\tif (height < 1) height = 1;\n\n\t\tvar geo = this._geoCache[height];\n\t\tif (!geo) {\n\t\t\tthis.extrudeSettings.amount = height;\n\t\t\tgeo = new THREE.ExtrudeGeometry(this.cellShape, this.extrudeSettings);\n\t\t\tthis._geoCache[height] = geo;\n\t\t}\n\n\t\t/*mat = this._matCache[c.matConfig.mat_cache_id];\n\t\tif (!mat) { // MaterialLoader? we currently only support basic stuff though. maybe later\n\t\t\tmat.map = Loader.loadTexture(c.matConfig.imgURL);\n\t\t\tdelete c.matConfig.imgURL;\n\t\t\tmat = new THREE[c.matConfig.type](c.matConfig);\n\t\t\tthis._matCache[c.matConfig.mat_cache_id] = mat;\n\t\t}*/\n\n\t\tvar tile = new vg.Tile({\n\t\t\tsize: this.cellSize,\n\t\t\tscale: scale,\n\t\t\tcell: cell,\n\t\t\tgeometry: geo,\n\t\t\tmaterial: material\n\t\t});\n\n\t\tcell.tile = tile;\n\n\t\treturn tile;\n\t},\n\n\tgenerateTiles: function(config) {\n\t\tconfig = config || {};\n\t\tvar tiles = [];\n\t\tvar settings = {\n\t\t\ttileScale: 0.95,\n\t\t\tcellSize: this.cellSize,\n\t\t\tmaterial: null,\n\t\t\textrudeSettings: {\n\t\t\t\tamount: 1,\n\t\t\t\tbevelEnabled: true,\n\t\t\t\tbevelSegments: 1,\n\t\t\t\tsteps: 1,\n\t\t\t\tbevelSize: 0.5,\n\t\t\t\tbevelThickness: 0.5\n\t\t\t}\n\t\t}\n\t\tsettings = vg.Tools.merge(settings, config);\n\n\t\t/*if (!settings.material) {\n\t\t\tsettings.material = new THREE.MeshPhongMaterial({\n\t\t\t\tcolor: vg.Tools.randomizeRGB('30, 30, 30', 10)\n\t\t\t});\n\t\t}*/\n\n\t\t// overwrite with any new dimensions\n\t\tthis.cellSize = settings.cellSize;\n\t\tthis._cellWidth = this.cellSize * 2;\n\t\tthis._cellLength = (vg.SQRT3 * 0.5) * this._cellWidth;\n\n\t\tthis.autogenerated = true;\n\t\tthis.extrudeSettings = settings.extrudeSettings;\n\n\t\tvar i, t, c;\n\t\tfor (i in this.cells) {\n\t\t\tc = this.cells[i];\n\t\t\tt = this.generateTile(c, settings.tileScale, settings.material);\n\t\t\tt.position.copy(this.cellToPixel(c));\n\t\t\tt.position.y = 0;\n\t\t\ttiles.push(t);\n\t\t}\n\t\treturn tiles;\n\t},\n\n\tgenerateTilePoly: function(material) {\n\t\tif (!material) {\n\t\t\tmaterial = new THREE.MeshBasicMaterial({color: 0x24b4ff});\n\t\t}\n\t\tvar mesh = new THREE.Mesh(this.cellShapeGeo, material);\n\t\tthis._vec3.set(1, 0, 0);\n\t\tmesh.rotateOnAxis(this._vec3, vg.PI/2);\n\t\treturn mesh;\n\t},\n\n\t// create a flat, hexagon-shaped grid\n\tgenerate: function(config) {\n\t\tconfig = config || {};\n\t\tthis.size = typeof config.size === 'undefined' ? this.size : config.size;\n\t\tvar x, y, z, c;\n\t\tfor (x = -this.size; x < this.size+1; x++) {\n\t\t\tfor (y = -this.size; y < this.size+1; y++) {\n\t\t\t\tz = -x-y;\n\t\t\t\tif (Math.abs(x) <= this.size && Math.abs(y) <= this.size && Math.abs(z) <= this.size) {\n\t\t\t\t\tc = new vg.Cell(x, y, z);\n\t\t\t\t\tthis.add(c);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tgenerateOverlay: function(size, overlayObj, overlayMat) {\n\t\tvar x, y, z;\n\t\tvar geo = this.cellShape.createPointsGeometry();\n\t\tfor (x = -size; x < size+1; x++) {\n\t\t\tfor (y = -size; y < size+1; y++) {\n\t\t\t\tz = -x-y;\n\t\t\t\tif (Math.abs(x) <= size && Math.abs(y) <= size && Math.abs(z) <= size) {\n\t\t\t\t\tthis._cel.set(x, y, z); // define the cell\n\t\t\t\t\tvar line = new THREE.Line(geo, overlayMat);\n\t\t\t\t\tline.position.copy(this.cellToPixel(this._cel));\n\t\t\t\t\tline.rotation.x = 90 * vg.DEG_TO_RAD;\n\t\t\t\t\toverlayObj.add(line);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tadd: function(cell) {\n\t\tvar h = this.cellToHash(cell);\n\t\tif (this.cells[h]) {\n\t\t\t// console.warn('A cell already exists there');\n\t\t\treturn;\n\t\t}\n\t\tthis.cells[h] = cell;\n\t\tthis.numCells++;\n\n\t\treturn cell;\n\t},\n\n\tremove: function(cell) {\n\t\tvar h = this.cellToHash(cell);\n\t\tif (this.cells[h]) {\n\t\t\tdelete this.cells[h];\n\t\t\tthis.numCells--;\n\t\t}\n\t},\n\n\tdispose: function() {\n\t\tthis.cells = null;\n\t\tthis.numCells = 0;\n\t\tthis.cellShape = null;\n\t\tthis.cellGeo.dispose();\n\t\tthis.cellGeo = null;\n\t\tthis.cellShapeGeo.dispose();\n\t\tthis.cellShapeGeo = null;\n\t\tthis._list = null;\n\t\tthis._vec3 = null;\n\t\tthis._conversionVec = null;\n\t\tthis._geoCache = null;\n\t\tthis._matCache = null;\n\t},\n\n\t/*\n\t\tLoad a grid from a parsed json object.\n\t\tjson = {\n\t\t\textrudeSettings,\n\t\t\tsize,\n\t\t\tcellSize,\n\t\t\tautogenerated,\n\t\t\tcells: [],\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\tcache_id: 0,\n\t\t\t\t\ttype: 'MeshLambertMaterial',\n\t\t\t\t\tcolor, ambient, emissive, reflectivity, refractionRatio, wrapAround,\n\t\t\t\t\timgURL: url\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcacheId: 1, ...\n\t\t\t\t}\n\t\t\t\t...\n\t\t\t]\n\t\t}\n\t*/\n\tload: function(url, cb, scope) {\n\t\tvar self = this;\n\t\tvg.Tools.getJSON({\n\t\t\turl: url,\n\t\t\tcallback: function(json) {\n\t\t\t\tself.fromJSON(json);\n\t\t\t\tcb.call(scope || null, json);\n\t\t\t},\n\t\t\tcache: false,\n\t\t\tscope: self\n\t\t});\n\t},\n\n\tfromJSON: function(json) {\n\t\tvar i, c;\n\t\tvar cells = json.cells;\n\n\t\tthis.cells = {};\n\t\tthis.numCells = 0;\n\n\t\tthis.size = json.size;\n\t\tthis.cellSize = json.cellSize;\n\t\tthis._cellWidth = this.cellSize * 2;\n\t\tthis._cellLength = (vg.SQRT3 * 0.5) * this._cellWidth;\n\n\t\tthis.extrudeSettings = json.extrudeSettings;\n\t\tthis.autogenerated = json.autogenerated;\n\n\t\tfor (i = 0; i < cells.length; i++) {\n\t\t\tc = new vg.Cell();\n\t\t\tc.copy(cells[i]);\n\t\t\tthis.add(c);\n\t\t}\n\t},\n\n\ttoJSON: function() {\n\t\tvar json = {\n\t\t\tsize: this.size,\n\t\t\tcellSize: this.cellSize,\n\t\t\textrudeSettings: this.extrudeSettings,\n\t\t\tautogenerated: this.autogenerated\n\t\t};\n\t\tvar cells = [];\n\t\tvar c, k;\n\n\t\tfor (k in this.cells) {\n\t\t\tc = this.cells[k];\n\t\t\tcells.push({\n\t\t\t\tq: c.q,\n\t\t\t\tr: c.r,\n\t\t\t\ts: c.s,\n\t\t\t\th: c.h,\n\t\t\t\twalkable: c.walkable,\n\t\t\t\tuserData: c.userData\n\t\t\t});\n\t\t}\n\t\tjson.cells = cells;\n\n\t\treturn json;\n\t},\n\n\t/*  ________________________________________________________________________\n\t\tHexagon-specific conversion math\n\t\tMostly commented out because they're inlined whenever possible to increase performance.\n\t\tThey're still here for reference.\n\t */\n\n\t_createVertex: function(i) {\n\t\tvar angle = (vg.TAU / 6) * i;\n\t\treturn new THREE.Vector3((this.cellSize * Math.cos(angle)), (this.cellSize * Math.sin(angle)), 0);\n\t},\n\n\t/*_pixelToAxial: function(pos) {\n\t\tvar q, r; // = x, y\n\t\tq = pos.x * ((2/3) / this.cellSize);\n\t\tr = ((-pos.x / 3) + (vg.SQRT3/3) * pos.y) / this.cellSize;\n\t\tthis._cel.set(q, r, -q-r);\n\t\treturn this._cubeRound(this._cel);\n\t},*/\n\n\t/*_axialToCube: function(h) {\n\t\treturn {\n\t\t\tq: h.q,\n\t\t\tr: h.r,\n\t\t\ts: -h.q - h.r\n\t\t};\n\t},*/\n\n\t/*_cubeToAxial: function(cell) {\n\t\treturn cell; // yep\n\t},*/\n\n\t/*_axialToPixel: function(cell) {\n\t\tvar x, y; // = q, r\n\t\tx = cell.q * this._cellWidth * 0.75;\n\t\ty = (cell.s - cell.r) * this._cellLength * 0.5;\n\t\treturn {x: x, y: -y};\n\t},*/\n\n\t/*_hexToPixel: function(h) {\n\t\tvar x, y; // = q, r\n\t\tx = this.cellSize * 1.5 * h.x;\n\t\ty = this.cellSize * vg.SQRT3 * (h.y + (h.x * 0.5));\n\t\treturn {x: x, y: y};\n\t},*/\n\n\t/*_axialRound: function(h) {\n\t\treturn this._cubeRound(this.axialToCube(h));\n\t},*/\n\n\t_cubeRound: function(h) {\n\t\tvar rx = Math.round(h.q);\n\t\tvar ry = Math.round(h.r);\n\t\tvar rz = Math.round(h.s);\n\n\t\tvar xDiff = Math.abs(rx - h.q);\n\t\tvar yDiff = Math.abs(ry - h.r);\n\t\tvar zDiff = Math.abs(rz - h.s);\n\n\t\tif (xDiff > yDiff && xDiff > zDiff) {\n\t\t\trx = -ry-rz;\n\t\t}\n\t\telse if (yDiff > zDiff) {\n\t\t\try = -rx-rz;\n\t\t}\n\t\telse {\n\t\t\trz = -rx-ry;\n\t\t}\n\n\t\treturn this._cel.set(rx, ry, rz);\n\t},\n\n\t/*_cubeDistance: function(a, b) {\n\t\treturn Math.max(Math.abs(a.q - b.q), Math.abs(a.r - b.r), Math.abs(a.s - b.s));\n\t}*/\n};\n\nvg.HexGrid.prototype.constructor = vg.HexGrid;\n","/*\n\tGraph of squares. Handles grid cell management (placement math for eg pathfinding, range, etc) and grid conversion math.\n\tInterface:\n\ttype\n\tsize - number of cells (in radius); only used if the map is generated\n\tcellSize\n\tcells - a hash so we can have sparse maps\n\tnumCells\n\textrudeSettings\n\tautogenerated\n\tcellShape\n\tcellGeo\n\tcellShapeGeo\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nvg.SqrGrid = function(config) {\n\tconfig = config || {};\n\t/*  ______________________________________________\n\t\tGRID INTERFACE:\n\t*/\n\tthis.type = vg.SQR;\n\tthis.size = 5; // only used for generated maps\n\tthis.cellSize = typeof config.cellSize === 'undefined' ? 10 : config.cellSize;\n\tthis.cells = {};\n\tthis.numCells = 0;\n\n\tthis.extrudeSettings = null;\n\tthis.autogenerated = false;\n\n\t// create base shape used for building geometry\n\tvar verts = [];\n\tverts.push(new THREE.Vector3());\n\tverts.push(new THREE.Vector3(-this.cellSize, this.cellSize));\n\tverts.push(new THREE.Vector3(this.cellSize, this.cellSize));\n\tverts.push(new THREE.Vector3(this.cellSize, -this.cellSize));\n\t// copy the verts into a shape for the geometry to use\n\tthis.cellShape = new THREE.Shape();\n\tthis.cellShape.moveTo(-this.cellSize, -this.cellSize);\n\tthis.cellShape.lineTo(-this.cellSize, this.cellSize);\n\tthis.cellShape.lineTo(this.cellSize, this.cellSize);\n\tthis.cellShape.lineTo(this.cellSize, -this.cellSize);\n\tthis.cellShape.lineTo(-this.cellSize, -this.cellSize);\n\n\tthis.cellGeo = new THREE.Geometry();\n\tthis.cellGeo.vertices = verts;\n\tthis.cellGeo.verticesNeedUpdate = true;\n\n\tthis.cellShapeGeo = new THREE.ShapeGeometry(this.cellShape);\n\n\t/*  ______________________________________________\n\t\tPRIVATE\n\t*/\n\n\tthis._fullCellSize = this.cellSize * 2;\n\tthis._hashDelimeter = '.';\n\t// pre-computed permutations\n\tthis._directions = [new vg.Cell(+1, 0, 0), new vg.Cell(0, -1, 0),\n\t\t\t\t\t\tnew vg.Cell(-1, 0, 0), new vg.Cell(0, +1, 0)];\n\tthis._diagonals = [new vg.Cell(-1, -1, 0), new vg.Cell(-1, +1, 0),\n\t\t\t\t\t   new vg.Cell(+1, +1, 0), new vg.Cell(+1, -1, 0)];\n\t// cached objects\n\tthis._list = [];\n\tthis._vec3 = new THREE.Vector3();\n\tthis._cel = new vg.Cell();\n\tthis._conversionVec = new THREE.Vector3();\n\tthis._geoCache = [];\n\tthis._matCache = [];\n};\n\nvg.SqrGrid.prototype = {\n\t/*\n\t\t________________________________________________________________________\n\t\tHigh-level functions that the Board interfaces with (all grids implement)\n\t */\n\n\tcellToPixel: function(cell) {\n\t\tthis._vec3.x = cell.q * this._fullCellSize;\n\t\tthis._vec3.y = cell.h;\n\t\tthis._vec3.z = cell.r * this._fullCellSize;\n\t\treturn this._vec3;\n\t},\n\n\tpixelToCell: function(pos) {\n\t\tvar q = Math.round(pos.x / this._fullCellSize);\n\t\tvar r = Math.round(pos.z / this._fullCellSize);\n\t\treturn this._cel.set(q, r, 0);\n\t},\n\n\tgetCellAt: function(pos) {\n\t\tvar q = Math.round(pos.x / this._fullCellSize);\n\t\tvar r = Math.round(pos.z / this._fullCellSize);\n\t\tthis._cel.set(q, r);\n\t\treturn this.cells[this.cellToHash(this._cel)];\n\t},\n\n\tgetNeighbors: function(cell, diagonal, filter) {\n\t\t// always returns an array\n\t\tvar i, n, l = this._directions.length;\n\t\tthis._list.length = 0;\n\t\tfor (i = 0; i < l; i++) {\n\t\t\tthis._cel.copy(cell);\n\t\t\tthis._cel.add(this._directions[i]);\n\t\t\tn = this.cells[this.cellToHash(this._cel)];\n\t\t\tif (!n || (filter && !filter(cell, n))) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis._list.push(n);\n\t\t}\n\t\tif (diagonal) {\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tthis._cel.copy(cell);\n\t\t\t\tthis._cel.add(this._diagonals[i]);\n\t\t\t\tn = this.cells[this.cellToHash(this._cel)];\n\t\t\t\tif (!n || (filter && !filter(cell, n))) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tthis._list.push(n);\n\t\t\t}\n\t\t}\n\t\treturn this._list;\n\t},\n\n\tgetRandomCell: function() {\n\t\tvar c, i = 0, x = vg.Tools.randomInt(0, this.numCells);\n\t\tfor (c in this.cells) {\n\t\t\tif (i === x) {\n\t\t\t\treturn this.cells[c];\n\t\t\t}\n\t\t\ti++;\n\t\t}\n\t\treturn this.cells[c];\n\t},\n\n\tcellToHash: function(cell) {\n\t\treturn cell.q+this._hashDelimeter+cell.r; // s is not used in a square grid\n\t},\n\n\tdistance: function(cellA, cellB) {\n\t\tvar d = Math.max(Math.abs(cellA.q - cellB.q), Math.abs(cellA.r - cellB.r));\n\t\td += cellB.h - cellA.h; // include vertical size\n\t\treturn d;\n\t},\n\n\tclearPath: function() {\n\t\tvar i, c;\n\t\tfor (i in this.cells) {\n\t\t\tc = this.cells[i];\n\t\t\tc._calcCost = 0;\n\t\t\tc._priority = 0;\n\t\t\tc._parent = null;\n\t\t\tc._visited = false;\n\t\t}\n\t},\n\n\ttraverse: function(cb) {\n\t\tvar i;\n\t\tfor (i in this.cells) {\n\t\t\tcb(this.cells[i]);\n\t\t}\n\t},\n\n\tgenerateTile: function(cell, scale, material) {\n\t\tvar height = Math.abs(cell.h);\n\t\tif (height < 1) height = 1;\n\n\t\tvar geo = this._geoCache[height];\n\t\tif (!geo) {\n\t\t\tthis.extrudeSettings.amount = height;\n\t\t\tgeo = new THREE.ExtrudeGeometry(this.cellShape, this.extrudeSettings);\n\t\t\tthis._geoCache[height] = geo;\n\t\t}\n\n\t\t/*mat = this._matCache[c.matConfig.mat_cache_id];\n\t\tif (!mat) { // MaterialLoader? we currently only support basic stuff though. maybe later\n\t\t\tmat.map = Loader.loadTexture(c.matConfig.imgURL);\n\t\t\tdelete c.matConfig.imgURL;\n\t\t\tmat = new THREE[c.matConfig.type](c.matConfig);\n\t\t\tthis._matCache[c.matConfig.mat_cache_id] = mat;\n\t\t}*/\n\n\t\tvar t = new vg.Tile({\n\t\t\tsize: this.cellSize,\n\t\t\tscale: scale,\n\t\t\tcell: cell,\n\t\t\tgeometry: geo,\n\t\t\tmaterial: material\n\t\t});\n\n\t\tcell.tile = t;\n\n\t\treturn t;\n\t},\n\n\tgenerateTiles: function(config) {\n\t\tconfig = config || {};\n\t\tvar tiles = [];\n\t\tvar settings = {\n\t\t\ttileScale: 0.95,\n\t\t\tcellSize: this.cellSize,\n\t\t\tmaterial: null,\n\t\t\textrudeSettings: {\n\t\t\t\tamount: 1,\n\t\t\t\tbevelEnabled: true,\n\t\t\t\tbevelSegments: 1,\n\t\t\t\tsteps: 1,\n\t\t\t\tbevelSize: 0.5,\n\t\t\t\tbevelThickness: 0.5\n\t\t\t}\n\t\t}\n\t\tsettings = vg.Tools.merge(settings, config);\n\n\t\t/*if (!settings.material) {\n\t\t\tsettings.material = new THREE.MeshPhongMaterial({\n\t\t\t\tcolor: vg.Tools.randomizeRGB('30, 30, 30', 10)\n\t\t\t});\n\t\t}*/\n\n\t\t// overwrite with any new dimensions\n\t\tthis.cellSize = settings.cellSize;\n\t\tthis._fullCellSize = this.cellSize * 2;\n\n\t\tthis.autogenerated = true;\n\t\tthis.extrudeSettings = settings.extrudeSettings;\n\n\t\tvar i, t, c;\n\t\tfor (i in this.cells) {\n\t\t\tc = this.cells[i];\n\t\t\tt = this.generateTile(c, settings.tileScale, settings.material);\n\t\t\tt.position.copy(this.cellToPixel(c));\n\t\t\tt.position.y = 0;\n\t\t\ttiles.push(t);\n\t\t}\n\t\treturn tiles;\n\t},\n\n\tgenerateTilePoly: function(material) {\n\t\tif (!material) {\n\t\t\tmaterial = new THREE.MeshBasicMaterial({color: 0x24b4ff});\n\t\t}\n\t\tvar mesh = new THREE.Mesh(this.cellShapeGeo, material);\n\t\tthis._vec3.set(1, 0, 0);\n\t\tmesh.rotateOnAxis(this._vec3, vg.PI/2);\n\t\treturn mesh;\n\t},\n\n\t// create a flat, square-shaped grid\n\tgenerate: function(config) {\n\t\tconfig = config || {};\n\t\tthis.size = typeof config.size === 'undefined' ? this.size : config.size;\n\t\tvar x, y, c;\n\t\tvar half = Math.ceil(this.size / 2);\n\t\tfor (x = -half; x < half; x++) {\n\t\t\tfor (y = -half; y < half; y++) {\n\t\t\t\tc = new vg.Cell(x, y + 1);\n\t\t\t\tthis.add(c);\n\t\t\t}\n\t\t}\n\t},\n\n\tgenerateOverlay: function(size, overlayObj, overlayMat) {\n\t\tvar x, y;\n\t\tvar half = Math.ceil(size / 2);\n\t\tfor (x = -half; x < half; x++) {\n\t\t\tfor (y = -half; y < half; y++) {\n\t\t\t\tthis._cel.set(x, y); // define the cell\n\t\t\t\tvar line = new THREE.Line(this.cellGeo, overlayMat);\n\t\t\t\tline.position.copy(this.cellToPixel(this._cel));\n\t\t\t\tline.rotation.x = 90 * vg.DEG_TO_RAD;\n\t\t\t\toverlayObj.add(line);\n\t\t\t}\n\t\t}\n\t},\n\n\tadd: function(cell) {\n\t\tvar h = this.cellToHash(cell);\n\t\tif (this.cells[h]) {\n\t\t\t// console.warn('A cell already exists there');\n\t\t\treturn;\n\t\t}\n\t\tthis.cells[h] = cell;\n\t\tthis.numCells++;\n\n\t\treturn cell;\n\t},\n\n\tremove: function(cell) {\n\t\tvar h = this.cellToHash(cell);\n\t\tif (this.cells[h]) {\n\t\t\tdelete this.cells[h];\n\t\t\tthis.numCells--;\n\t\t}\n\t},\n\n\tdispose: function() {\n\t\tthis.cells = null;\n\t\tthis.numCells = 0;\n\t\tthis.cellShape = null;\n\t\tthis.cellGeo.dispose();\n\t\tthis.cellGeo = null;\n\t\tthis.cellShapeGeo.dispose();\n\t\tthis.cellShapeGeo = null;\n\t\tthis._list = null;\n\t\tthis._vec3 = null;\n\t\tthis._conversionVec = null;\n\t\tthis._geoCache = null;\n\t\tthis._matCache = null;\n\t},\n\n\t/*\n\t\tLoad a grid from a parsed json object.\n\t\tjson = {\n\t\t\textrudeSettings,\n\t\t\tsize,\n\t\t\tcellSize,\n\t\t\tautogenerated,\n\t\t\tcells: [],\n\t\t\tmaterials: [\n\t\t\t\t{\n\t\t\t\t\tcache_id: 0,\n\t\t\t\t\ttype: 'MeshLambertMaterial',\n\t\t\t\t\tcolor, ambient, emissive, reflectivity, refractionRatio, wrapAround,\n\t\t\t\t\timgURL: url\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcacheId: 1, ...\n\t\t\t\t}\n\t\t\t\t...\n\t\t\t]\n\t\t}\n\t*/\n\tload: function(url, callback, scope) {\n\t\tvg.Tools.getJSON({\n\t\t\turl: url,\n\t\t\tcallback: function(json) {\n\t\t\t\tthis.fromJSON(json);\n\t\t\t\tcallback.call(scope || null, json);\n\t\t\t},\n\t\t\tcache: false,\n\t\t\tscope: this\n\t\t});\n\t},\n\n\tfromJSON: function(json) {\n\t\tvar i, c;\n\t\tvar cells = json.cells;\n\n\t\tthis.cells = {};\n\t\tthis.numCells = 0;\n\n\t\tthis.size = json.size;\n\t\tthis.cellSize = json.cellSize;\n\t\tthis._fullCellSize = this.cellSize * 2;\n\t\tthis.extrudeSettings = json.extrudeSettings;\n\t\tthis.autogenerated = json.autogenerated;\n\n\t\tfor (i = 0; i < cells.length; i++) {\n\t\t\tc = new vg.Cell();\n\t\t\tc.copy(cells[i]);\n\t\t\tthis.add(c);\n\t\t}\n\t},\n\n\ttoJSON: function() {\n\t\tvar json = {\n\t\t\tsize: this.size,\n\t\t\tcellSize: this.cellSize,\n\t\t\textrudeSettings: this.extrudeSettings,\n\t\t\tautogenerated: this.autogenerated\n\t\t};\n\t\tvar cells = [];\n\t\tvar c, k;\n\n\t\tfor (k in this.cells) {\n\t\t\tc = this.cells[k];\n\t\t\tcells.push({\n\t\t\t\tq: c.q,\n\t\t\t\tr: c.r,\n\t\t\t\ts: c.s,\n\t\t\t\th: c.h,\n\t\t\t\twalkable: c.walkable,\n\t\t\t\tuserData: c.userData\n\t\t\t});\n\t\t}\n\t\tjson.cells = cells;\n\n\t\treturn json;\n\t}\n};\n\nvg.SqrGrid.prototype.constructor = vg.SqrGrid;\n","/*\n\tExample tile class that constructs its geometry for rendering and holds some gameplay properties.\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n*/\nvg.Tile = function(config) {\n\tconfig = config || {};\n\tvar settings = {\n\t\tcell: null, // required vg.Cell\n\t\tgeometry: null, // required threejs geometry\n\t\tmaterial: null // not required but it would improve performance significantly\n\t};\n\tsettings = vg.Tools.merge(settings, config);\n\n\tif (!settings.cell || !settings.geometry) {\n\t\tthrow new Error('Missing vg.Tile configuration');\n\t}\n\n\tthis.cell = settings.cell;\n\tif (this.cell.tile && this.cell.tile !== this) this.cell.tile.dispose(); // remove whatever was there\n\tthis.cell.tile = this;\n\n\tthis.uniqueID = vg.Tools.generateID();\n\n\tthis.geometry = settings.geometry;\n\tthis.material = settings.material;\n\tif (!this.material) {\n\t\tthis.material = new THREE.MeshPhongMaterial({\n\t\t\tcolor: vg.Tools.randomizeRGB('30, 30, 30', 13)\n\t\t});\n\t}\n\n\tthis.objectType = vg.TILE;\n\tthis.entity = null;\n\tthis.userData = {};\n\n\tthis.selected = false;\n\tthis.highlight = '0x0084cc';\n\n\tthis.mesh = new THREE.Mesh(this.geometry, this.material);\n\tthis.mesh.userData.structure = this;\n\n\t// create references so we can control orientation through this (Tile), instead of drilling down\n\tthis.position = this.mesh.position;\n\tthis.rotation = this.mesh.rotation;\n\n\t// rotate it to face \"up\" (the threejs coordinate space is Y+)\n\tthis.rotation.x = -90 * vg.DEG_TO_RAD;\n\tthis.mesh.scale.set(settings.scale, settings.scale, 1);\n\n\tif (this.material.emissive) {\n\t\tthis._emissive = this.material.emissive.getHex();\n\t}\n\telse {\n\t\tthis._emissive = null;\n\t}\n};\n\nvg.Tile.prototype = {\n\tselect: function() {\n\t\tif (this.material.emissive) {\n\t\t\tthis.material.emissive.setHex(this.highlight);\n\t\t}\n\t\tthis.selected = true;\n\t\treturn this;\n\t},\n\n\tdeselect: function() {\n\t\tif (this._emissive !== null && this.material.emissive) {\n\t\t\tthis.material.emissive.setHex(this._emissive);\n\t\t}\n\t\tthis.selected = false;\n\t\treturn this;\n\t},\n\n\ttoggle: function() {\n\t\tif (this.selected) {\n\t\t\tthis.deselect();\n\t\t}\n\t\telse {\n\t\t\tthis.select();\n\t\t}\n\t\treturn this;\n\t},\n\n\tdispose: function() {\n\t\tif (this.cell && this.cell.tile) this.cell.tile = null;\n\t\tthis.cell = null;\n\t\tthis.position = null;\n\t\tthis.rotation = null;\n\t\tif (this.mesh.parent) this.mesh.parent.remove(this.mesh);\n\t\tthis.mesh.userData.structure = null;\n\t\tthis.mesh = null;\n\t\tthis.material = null;\n\t\tthis.userData = null;\n\t\tthis.entity = null;\n\t\tthis.geometry = null;\n\t\tthis._emissive = null;\n\t}\n};\n\nvg.Tile.prototype.constructor = vg.Tile;\n","/*\n\tA high-speed doubly-linked list of objects. Note that for speed reasons (using a dictionary lookup of\n\tcached nodes) there can only be a single instance of an object in the list at the same time. Adding the same\n\tobject a second time will result in a silent return from the add method.\n\n\tIn order to keep a track of node links, an object must be able to identify itself with a uniqueID function.\n\n\tTo add an item use:\n\t<pre><code>\n\t\tlist.add(newItem);\n\t</code></pre>\n\t<p>\n\tYou can iterate using the first and next members, such as:\n\t<pre><code>\n\t\tvar node = list.first;\n\t\twhile (node)\n\t\t{\n\t\t\tnode.object().DOSOMETHING();\n\t\t\tnode = node.next();\n\t\t}\n\t</code></pre>\n */\n(function() {\n\tvar LinkedListNode = function() {\n\t\tthis.obj = null;\n\t\tthis.next = null;\n\t\tthis.prev = null;\n\t\tthis.free = true;\n\t};\n\n\tvar LinkedList = function() {\n\t\tthis.first = null;\n\t\tthis.last = null;\n\t\tthis.length = 0;\n\t\tthis.objToNodeMap = {}; // a quick lookup list to map linked list nodes to objects\n\t\tthis.uniqueID = Date.now() + '' + Math.floor(Math.random()*1000);\n\n\t\tthis.sortArray = [];\n\t};\n\n\t// static function for utility\n\tLinkedList.generateID = function() {\n\t\treturn Math.random().toString(36).slice(2) + Date.now();\n\t};\n\n\tLinkedList.prototype = {\n\t\t/*\n\t\t\tGet the LinkedListNode for this object.\n\t\t\t@param obj The object to get the node for\n\t\t */\n\t\tgetNode: function(obj) {\n\t\t\t// objects added to a list must implement a uniqueID which returns a unique object identifier string\n\t\t\treturn this.objToNodeMap[obj.uniqueID];\n\t\t},\n\n\t\t/*\n\t\t\tAdds a new node to the list -- typically only used internally unless you're doing something funky\n\t\t\tUse add() to add an object to the list, not this.\n\t\t */\n\t\taddNode: function(obj) {\n\t\t\tvar node = new LinkedListNode();\n\t\t\tif (!obj.uniqueID) {\n\t\t\t\ttry {\n\t\t\t\t\tobj.uniqueID = LinkedList.generateID();\n\t\t\t\t\t// console.log('New ID: '+obj.uniqueID);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\tconsole.error('[LinkedList.addNode] obj passed is immutable: cannot attach necessary identifier');\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnode.obj = obj;\n\t\t\tnode.free = false;\n\t\t\tthis.objToNodeMap[obj.uniqueID] = node;\n\t\t\treturn node;\n\t\t},\n\n\t\tswapObjects: function(node, newObj) {\n\t\t\tthis.objToNodeMap[node.obj.uniqueID] = null;\n\t\t\tthis.objToNodeMap[newObj.uniqueID] = node;\n\t\t\tnode.obj = newObj;\n\t\t},\n\n\t\t/*\n\t\t\tAdd an item to the list\n\t\t\t@param obj The object to add\n\t\t */\n\t\tadd: function(obj) {\n\t\t\tvar node = this.objToNodeMap[obj.uniqueID];\n\n\t\t\tif (!node) {\n\t\t\t\tnode = this.addNode(obj);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (node.free === false) return;\n\n\t\t\t\t// reusing a node, so we clean it up\n\t\t\t\t// this caching of node/object pairs is the reason an object can only exist\n\t\t\t\t// once in a list -- which also makes things faster (not always creating new node\n\t\t\t\t// object every time objects are moving on and off the list\n\t\t\t\tnode.obj = obj;\n\t\t\t\tnode.free = false;\n\t\t\t\tnode.next = null;\n\t\t\t\tnode.prev = null;\n\t\t\t}\n\n\t\t\t// append this obj to the end of the list\n\t\t\tif (!this.first) { // is this the first?\n\t\t\t\tthis.first = node;\n\t\t\t\tthis.last = node;\n\t\t\t\tnode.next = null; // clear just in case\n\t\t\t\tnode.prev = null;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!this.last) {\n\t\t\t\t\tthrow new Error(\"[LinkedList.add] No last in the list -- that shouldn't happen here\");\n\t\t\t\t}\n\n\t\t\t\t// add this entry to the end of the list\n\t\t\t\tthis.last.next = node; // current end of list points to the new end\n\t\t\t\tnode.prev = this.last;\n\t\t\t\tthis.last = node;            // new object to add becomes last in the list\n\t\t\t\tnode.next = null;      // just in case this was previously set\n\t\t\t}\n\t\t\tthis.length++;\n\n\t\t\tif (this.showDebug) this.dump('after add');\n\t\t},\n\n\t\thas: function(obj) {\n\t\t\treturn !!this.objToNodeMap[obj.uniqueID];\n\t\t},\n\n\t\t/*\n\t\t\tMoves this item upwards in the list\n\t\t\t@param obj\n\t\t */\n\t\tmoveUp: function(obj) {\n\t\t\tthis.dump('before move up');\n\t\t\tvar c = this.getNode(obj);\n\t\t\tif (!c) throw \"Oops, trying to move an object that isn't in the list\";\n\t\t\tif (!c.prev) return; // already first, ignore\n\n\t\t\t// This operation makes C swap places with B:\n\t\t\t// A <-> B <-> C <-> D\n\t\t\t// A <-> C <-> B <-> D\n\n\t\t\tvar b = c.prev;\n\t\t\tvar a = b.prev;\n\n\t\t\t// fix last\n\t\t\tif (c == this.last) this.last = b;\n\n\t\t\tvar oldCNext = c.next;\n\n\t\t\tif (a) a.next = c;\n\t\t\tc.next = b;\n\t\t\tc.prev = b.prev;\n\n\t\t\tb.next = oldCNext;\n\t\t\tb.prev = c;\n\n\t\t\t// check to see if we are now first\n\t\t\tif (this.first == b) this.first = c;\n\t\t},\n\n\t\t/*\n\t\t\tMoves this item downwards in the list\n\t\t\t@param obj\n\t\t */\n\t\tmoveDown: function(obj) {\n\t\t\tvar b = this.getNode(obj);\n\t\t\tif (!b) throw \"Oops, trying to move an object that isn't in the list\";\n\t\t\tif (!b.next) return; // already last, ignore\n\n\t\t\t// This operation makes B swap places with C:\n\t\t\t// A <-> B <-> C <-> D\n\t\t\t// A <-> C <-> B <-> D\n\n\t\t\tvar c = b.next;\n\t\t\tthis.moveUp(c.obj);\n\n\t\t\t// check to see if we are now last\n\t\t\tif (this.last == c) this.last = b;\n\t\t},\n\n\t\t/*\n\t\t\tTake everything off the list and put it in an array, sort it, then put it back.\n\t\t */\n\t\tsort: function(compare) {\n\t\t\tvar sortArray = this.sortArray;\n\t\t\tvar i, l, node = this.first;\n\t\t\tsortArray.length = 0;\n\n\t\t\twhile (node) {\n\t\t\t\tsortArray.push(node.obj);\n\t\t\t\tnode = node.next;\n\t\t\t}\n\n\t\t\tthis.clear();\n\n\t\t\tsortArray.sort(compare);\n\t\t\t// console.log(sortArray);\n\t\t\tl = sortArray.length;\n\t\t\tfor (i = 0; i < l; i++) {\n\t\t\t\tthis.add(sortArray[i]);\n\t\t\t}\n\t\t},\n\n\t\t/*\n\t\t\tRemoves an item from the list\n\t\t\t@param obj The object to remove\n\t\t\t@returns boolean true if the item was removed, false if the item was not on the list\n\t\t */\n\t\tremove: function(obj) {\n\t\t\tvar node = this.getNode(obj);\n\t\t\tif (!node || node.free){\n\t\t\t\treturn false; // ignore this error (trying to remove something not there)\n\t\t\t}\n\n\t\t\t// pull this object out and tie up the ends\n\t\t\tif (node.prev) node.prev.next = node.next;\n\t\t\tif (node.next) node.next.prev = node.prev;\n\n\t\t\t// fix first and last\n\t\t\tif (!node.prev) // if this was first on the list\n\t\t\t\tthis.first = node.next; // make the next on the list first (can be null)\n\t\t\tif (!node.next) // if this was the last\n\t\t\t\tthis.last = node.prev; // then this node's previous becomes last\n\n\t\t\tnode.free = true;\n\t\t\tnode.prev = null;\n\t\t\tnode.next = null;\n\n\t\t\tthis.length--;\n\n\t\t\treturn true;\n\t\t},\n\n\t\t// remove the head and return it's object\n\t\tshift: function() {\n\t\t\tvar node = this.first;\n\t\t\tif (this.length === 0) return null;\n\t\t\t// if (node == null || node.free == true) return null;\n\n\t\t\t// pull this object out and tie up the ends\n\t\t\tif (node.prev) {\n\t\t\t\tnode.prev.next = node.next;\n\t\t\t}\n\t\t\tif (node.next) {\n\t\t\t\tnode.next.prev = node.prev;\n\t\t\t}\n\n\t\t\t// make the next on the list first (can be null)\n\t\t\tthis.first = node.next;\n\t\t\tif (!node.next) this.last = null; // make sure we clear this\n\n\t\t\tnode.free = true;\n\t\t\tnode.prev = null;\n\t\t\tnode.next = null;\n\n\t\t\tthis.length--;\n\t\t\treturn node.obj;\n\t\t},\n\n\t\t// remove the tail and return it's object\n\t\tpop: function() {\n\t\t\tvar node = this.last;\n\t\t\tif (this.length === 0) return null;\n\n\t\t\t// pull this object out and tie up the ends\n\t\t\tif (node.prev) {\n\t\t\t\tnode.prev.next = node.next;\n\t\t\t}\n\t\t\tif (node.next) {\n\t\t\t\tnode.next.prev = node.prev;\n\t\t\t}\n\n\t\t\t// this node's previous becomes last\n\t\t\tthis.last = node.prev;\n\t\t\tif (!node.prev) this.first = null; // make sure we clear this\n\n\t\t\tnode.free = true;\n\t\t\tnode.prev = null;\n\t\t\tnode.next = null;\n\n\t\t\tthis.length--;\n\t\t\treturn node.obj;\n\t\t},\n\n\t\t/**\n\t\t * Add the passed list to this list, leaving it untouched.\n\t\t */\n\t\tconcat: function(list) {\n\t\t\tvar node = list.first;\n\t\t\twhile (node) {\n\t\t\t\tthis.add(node.obj);\n\t\t\t\tnode = node.next;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Clears the list out\n\t\t */\n\t\tclear: function() {\n\t\t\tvar next = this.first;\n\n\t\t\twhile (next) {\n\t\t\t\tnext.free = true;\n\t\t\t\tnext = next.next;\n\t\t\t}\n\n\t\t\tthis.first = null;\n\t\t\tthis.length = 0;\n\t\t},\n\n\t\tdispose: function() {\n\t\t\tvar next = this.first;\n\n\t\t\twhile (next) {\n\t\t\t\tnext.obj = null;\n\t\t\t\tnext = next.next;\n\t\t\t}\n\t\t\tthis.first = null;\n\n\t\t\tthis.objToNodeMap = null;\n\t\t},\n\n\t\t/*\n\t\t\tOutputs the contents of the current list for debugging.\n\t\t */\n\t\tdump: function(msg) {\n\t\t\tconsole.log('====================' + msg + '=====================');\n\t\t\tvar a = this.first;\n\t\t\twhile (a) {\n\t\t\t\tconsole.log(\"{\" + a.obj.toString() + \"} previous=\" + (a.prev ? a.prev.obj : \"NULL\"));\n\t\t\t\ta = a.next();\n\t\t\t}\n\t\t\tconsole.log(\"===================================\");\n\t\t\tconsole.log(\"Last: {\" + (this.last ? this.last.obj : 'NULL') + \"} \" +\n\t\t\t\t\"First: {\" + (this.first ? this.first.obj : 'NULL') + \"}\");\n\t\t}\n\t};\n\n\tLinkedList.prototype.constructor = LinkedList;\n\n\tvg.LinkedList = LinkedList;\n}());","(function() {\n    var SignalBinding = function (signal, listener, isOnce, listenerContext, priority) {\n        /**\n        * @property _listener - Handler function bound to the signal.\n        * @private\n        */\n        this._listener = listener;\n\n        /**\n        * @property {boolean} isOnce - If binding should be executed just once.\n        * @private\n        */\n        this.isOnce = isOnce;\n\n        /**\n        * @property {object|undefined|null} context - Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n        */\n        this.context = listenerContext;\n\n        /**\n        * @property {Signal} signal - Reference to Signal object that listener is currently bound to.\n        * @private\n        */\n        this.signal = signal;\n\n        /**\n        * @property {number} _priority - Listener priority.\n        * @private\n        */\n        this._priority = priority || 0;\n    };\n\n    SignalBinding.prototype = {\n        /**\n        * If binding is active and should be executed.\n        * @property {boolean} active\n        * @default\n        */\n        active: true,\n\n        /**\n        * Default parameters passed to listener during `Signal.dispatch` and `SignalBinding.execute` (curried parameters).\n        * @property {array|null} params\n        * @default\n        */\n        params: null,\n\n        /**\n        * Call listener passing arbitrary parameters.\n        * If binding was added using `Signal.addOnce()` it will be automatically removed from signal dispatch queue, this method is used internally for the signal dispatch.\n        * @method SignalBinding#execute\n        * @param {array} [paramsArr] - Array of parameters that should be passed to the listener.\n        * @return {any} Value returned by the listener.\n        */\n        execute: function(paramsArr) {\n\n            var handlerReturn, params;\n\n            if (this.active && !!this._listener) {\n                params = this.params ? this.params.concat(paramsArr) : paramsArr;\n                handlerReturn = this._listener.apply(this.context, params);\n\n                if (this.isOnce) {\n                    this.detach();\n                }\n            }\n\n            return handlerReturn;\n\n        },\n\n        /**\n        * Detach binding from signal.\n        * alias to: @see mySignal.remove(myBinding.listener);\n        * @method SignalBinding#detach\n        * @return {function|null} Handler function bound to the signal or `null` if binding was previously detached.\n        */\n        detach: function () {\n            return this.isBound() ? this.signal.remove(this._listener, this.context) : null;\n        },\n\n        /**\n        * @method SignalBinding#isBound\n        * @return {boolean} True if binding is still bound to the signal and has a listener.\n        */\n        isBound: function () {\n            return (!!this.signal && !!this._listener);\n        },\n\n        /**\n        * Delete instance properties\n        * @method SignalBinding#_destroy\n        * @private\n        */\n        _destroy: function () {\n            delete this.signal;\n            delete this._listener;\n            delete this.context;\n        },\n\n        /**\n        * @method SignalBinding#toString\n        * @return {string} String representation of the object.\n        */\n        toString: function () {\n            return '[SignalBinding isOnce:' + this.isOnce +', isBound:'+ this.isBound() +', active:' + this.active + ']';\n        }\n    };\n\n    SignalBinding.prototype.constructor = SignalBinding;\n\n\n\n    /**\n    * @author       Miller Medeiros http://millermedeiros.github.com/js-signals/\n    * @author       Richard Davey <rich@photonstorm.com>\n    * @copyright    2014 Photon Storm Ltd.\n    * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}\n    */\n\n    /**\n    * A Signal is used for object communication via a custom broadcaster instead of Events.\n    *\n    * @class Signal\n    * @constructor\n    */\n    var Signal = function () {\n        /**\n        * @property {Array.<SignalBinding>} _bindings - Internal variable.\n        * @private\n        */\n        this._bindings = [];\n\n        /**\n        * @property {any} _prevParams - Internal variable.\n        * @private\n        */\n        this._prevParams = null;\n\n        // enforce dispatch to aways work on same context (#47)\n        var self = this;\n\n        /**\n        * @property {function} dispatch - The dispatch function is what sends the Signal out.\n        */\n        this.dispatch = function(){\n            Signal.prototype.dispatch.apply(self, arguments);\n        };\n\n    };\n\n    Signal.prototype = {\n        /**\n        * If Signal should keep record of previously dispatched parameters and\n        * automatically execute listener during `add()`/`addOnce()` if Signal was\n        * already dispatched before.\n        * @property {boolean} memorize\n        */\n        memorize: false,\n\n        /**\n        * @property {boolean} _shouldPropagate\n        * @private\n        */\n        _shouldPropagate: true,\n\n        /**\n        * If Signal is active and should broadcast events.\n        * IMPORTANT: Setting this property during a dispatch will only affect the next dispatch, if you want to stop the propagation of a signal use `halt()` instead.\n        * @property {boolean} active\n        * @default\n        */\n        active: true,\n\n        /**\n        * @method Signal#validateListener\n        * @param {function} listener - Signal handler function.\n        * @param {string} fnName - Function name.\n        * @private\n        */\n        validateListener: function (listener, fnName) {\n            if (typeof listener !== 'function') {\n                throw new Error('Signal: listener is a required param of {fn}() and should be a Function.'.replace('{fn}', fnName));\n            }\n        },\n\n        /**\n        * @method Signal#_registerListener\n        * @private\n        * @param {function} listener - Signal handler function.\n        * @param {boolean} isOnce - Should the listener only be called once?\n        * @param {object} [listenerContext] - The context under which the listener is invoked.\n        * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added. (default = 0).\n        * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n        */\n        _registerListener: function (listener, isOnce, listenerContext, priority) {\n            var prevIndex = this._indexOfListener(listener, listenerContext);\n            var binding;\n\n            if (prevIndex !== -1) {\n                binding = this._bindings[prevIndex];\n\n                if (binding.isOnce !== isOnce) {\n                    throw new Error('You cannot add' + (isOnce ? '' : 'Once') + '() then add' + (!isOnce ? '' : 'Once') + '() the same listener without removing the relationship first.');\n                }\n            }\n            else {\n                binding = new SignalBinding(this, listener, isOnce, listenerContext, priority);\n                this._addBinding(binding);\n            }\n\n            if (this.memorize && this._prevParams) {\n                binding.execute(this._prevParams);\n            }\n\n            return binding;\n        },\n\n        /**\n        * @method Signal#_addBinding\n        * @private\n        * @param {SignalBinding} binding - An Object representing the binding between the Signal and listener.\n        */\n        _addBinding: function (binding) {\n            //  Simplified insertion sort\n            var n = this._bindings.length;\n\n            do {\n                n--;\n            }\n            while (this._bindings[n] && binding._priority <= this._bindings[n]._priority);\n\n            this._bindings.splice(n + 1, 0, binding);\n        },\n\n        /**\n        * @method Signal#_indexOfListener\n        * @private\n        * @param {function} listener - Signal handler function.\n        * @return {number} The index of the listener within the private bindings array.\n        */\n        _indexOfListener: function (listener, context) {\n            var n = this._bindings.length;\n            var cur;\n\n            while (n--) {\n                cur = this._bindings[n];\n\n                if (cur._listener === listener && cur.context === context) {\n                    return n;\n                }\n            }\n\n            return -1;\n        },\n\n        /**\n        * Check if listener was attached to Signal.\n        *\n        * @method Signal#has\n        * @param {function} listener - Signal handler function.\n        * @param {object} [context] - Context on which listener will be executed (object that should represent the `this` variable inside listener function).\n        * @return {boolean} If Signal has the specified listener.\n        */\n        has: function (listener, context) {\n            return this._indexOfListener(listener, context) !== -1;\n        },\n\n        /**\n        * Add a listener to the signal.\n        *\n        * @method Signal#add\n        * @param {function} listener - The function to call when this Signal is dispatched.\n        * @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n        * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n        * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n        */\n        add: function (listener, listenerContext, priority) {\n            this.validateListener(listener, 'add');\n\n            return this._registerListener(listener, false, listenerContext, priority);\n        },\n\n        /**\n        * Add listener to the signal that should be removed after first execution (will be executed only once).\n        *\n        * @method Signal#addOnce\n        * @param {function} listener - The function to call when this Signal is dispatched.\n        * @param {object} [listenerContext] - The context under which the listener will be executed (i.e. the object that should represent the `this` variable).\n        * @param {number} [priority] - The priority level of the event listener. Listeners with higher priority will be executed before listeners with lower priority. Listeners with same priority level will be executed at the same order as they were added (default = 0)\n        * @return {SignalBinding} An Object representing the binding between the Signal and listener.\n        */\n        addOnce: function (listener, listenerContext, priority) {\n            this.validateListener(listener, 'addOnce');\n\n            return this._registerListener(listener, true, listenerContext, priority);\n        },\n\n        /**\n        * Remove a single listener from the dispatch queue.\n        *\n        * @method Signal#remove\n        * @param {function} listener - Handler function that should be removed.\n        * @param {object} [context] - Execution context (since you can add the same handler multiple times if executing in a different context).\n        * @return {function} Listener handler function.\n        */\n        remove: function (listener, context) {\n            this.validateListener(listener, 'remove');\n\n            var i = this._indexOfListener(listener, context);\n\n            if (i !== -1) {\n                this._bindings[i]._destroy(); //no reason to a SignalBinding exist if it isn't attached to a signal\n                this._bindings.splice(i, 1);\n            }\n\n            return listener;\n        },\n\n        /**\n        * Remove all listeners from the Signal.\n        *\n        * @method Signal#removeAll\n        * @param {object} [context=null] - If specified only listeners for the given context will be removed.\n        */\n        removeAll: function (context) {\n            if (typeof context === 'undefined') { context = null; }\n\n            var n = this._bindings.length;\n\n            while (n--) {\n                if (context) {\n                    if (this._bindings[n].context === context) {\n                        this._bindings[n]._destroy();\n                        this._bindings.splice(n, 1);\n                    }\n                }\n                else {\n                    this._bindings[n]._destroy();\n                }\n            }\n\n            if (!context) {\n                this._bindings.length = 0;\n            }\n        },\n\n        /**\n        * Gets the total number of listeneres attached to ths Signal.\n        *\n        * @method Signal#getNumListeners\n        * @return {number} Number of listeners attached to the Signal.\n        */\n        getNumListeners: function () {\n            return this._bindings.length;\n        },\n\n        /**\n        * Stop propagation of the event, blocking the dispatch to next listeners on the queue.\n        * IMPORTANT: should be called only during signal dispatch, calling it before/after dispatch won't affect signal broadcast.\n        * @see Signal.prototype.disable\n        *\n        * @method Signal#halt\n        */\n        halt: function () {\n            this._shouldPropagate = false;\n        },\n\n        /**\n        * Dispatch/Broadcast Signal to all listeners added to the queue.\n        *\n        * @method Signal#dispatch\n        * @param {any} [params] - Parameters that should be passed to each handler.\n        */\n        dispatch: function () {\n            if (!this.active) {\n                return;\n            }\n\n            var paramsArr = Array.prototype.slice.call(arguments);\n            var n = this._bindings.length;\n            var bindings;\n\n            if (this.memorize) {\n                this._prevParams = paramsArr;\n            }\n\n            if (!n) {\n                //  Should come after memorize\n                return;\n            }\n\n            bindings = this._bindings.slice(); //clone array in case add/remove items during dispatch\n            this._shouldPropagate = true; //in case `halt` was called before dispatch or during the previous dispatch.\n\n            //execute all callbacks until end of the list or until a callback returns `false` or stops propagation\n            //reverse loop since listeners with higher priority will be added at the end of the list\n            do {\n                n--;\n            }\n            while (bindings[n] && this._shouldPropagate && bindings[n].execute(paramsArr) !== false);\n        },\n\n        /**\n        * Forget memorized arguments.\n        * @see Signal.memorize\n        *\n        * @method Signal#forget\n        */\n        forget: function() {\n            this._prevParams = null;\n        },\n\n        /**\n        * Remove all bindings from signal and destroy any reference to external objects (destroy Signal object).\n        * IMPORTANT: calling any method on the signal instance after calling dispose will throw errors.\n        *\n        * @method Signal#dispose\n        */\n        dispose: function () {\n            this.removeAll();\n\n            delete this._bindings;\n            delete this._prevParams;\n        },\n\n        /**\n        *\n        * @method Signal#toString\n        * @return {string} String representation of the object.\n        */\n        toString: function () {\n            return '[Signal active:'+ this.active +' numListeners:'+ this.getNumListeners() +']';\n        }\n\n    };\n\n    Signal.prototype.constructor = Signal;\n\n    vg.Signal = Signal;\n}());\n","vg.Loader = {\n\tmanager: null,\n\timageLoader: null,\n\tcrossOrigin: false,\n\n\tinit: function(crossOrigin) {\n\t\tthis.crossOrigin = crossOrigin || false;\n\n\t\tthis.manager = new THREE.LoadingManager(function() {\n\t\t\t// called when all images are loaded, so call your state manager or something\n\t\t}, function() {\n\t\t\t// noop\n\t\t}, function() {\n\t\t\tconsole.warn('Error loading images');\n\t\t});\n\n\t\tthis.imageLoader = new THREE.ImageLoader(this.manager);\n\t\tthis.imageLoader.crossOrigin = crossOrigin;\n\t},\n\n\tloadTexture: function(url, mapping, onLoad, onError) {\n\t\tvar texture = new THREE.Texture(null, mapping);\n\t\tthis.imageLoader.load(url, function(image) { // on load\n\t\t\t\ttexture.image = image;\n\t\t\t\ttexture.needsUpdate = true;\n\t\t\t\tif (onLoad) onLoad(texture);\n\t\t\t},\n\t\t\tnull, // on progress\n\t\t\tfunction (evt) { // on error\n\t\t\t\tif (onError) onError(evt);\n\t\t\t});\n\t\ttexture.sourceFile = url;\n\n\t\treturn texture;\n\t}\n};\n","/*\n\tTranslates mouse interactivity into 3D positions, so we can easily pick objects in the scene.\n\n\tLike everything else in ThreeJS, ray casting creates a ton of new objects each time it's used. This contributes to frequent garbage collections (causing frame hitches), so if you're limited to low-end hardware like mobile, it would be better to only update it when the user clicks, instead of every frame (so no hover effects, but on mobile those don't work anyway). You'll want to create a version that handles touch anyway.\n\n\tgroup - any Object3D (Scene, Group, Mesh, Sprite, etc) that the mouse will cast against\n\tcamera - the camera to cast from\n\t[element] - optional element to attach mouse event to\n\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\nvg.MouseCaster = function(group, camera, element) {\n\tthis.down = false; // left click\n\tthis.rightDown = false;\n\t// the object that was just clicked on\n\tthis.pickedObject = null;\n\t// the object currently being 'held'\n\tthis.selectedObject = null;\n\t// store the results of the last cast\n\tthis.allHits = null;\n\t// disable the caster easily to temporarily prevent user input\n\tthis.active = true;\n\n\tthis.shift = false;\n\tthis.ctrl = false;\n\tthis.wheel = 0;\n\n\t// you can track exactly where the mouse is in the 3D scene by using the z component\n\tthis.position = new THREE.Vector3();\n\tthis.screenPosition = new THREE.Vector2();\n\tthis.signal = new vg.Signal();\n\tthis.group = group;\n\n\t// behind-the-scenes stuff you shouldn't worry about\n\tthis._camera = camera;\n\tthis._raycaster = new THREE.Raycaster();\n\tthis._preventDefault = false;\n\n\telement = element || document;\n\n\telement.addEventListener('mousemove', this._onDocumentMouseMove.bind(this), false);\n\telement.addEventListener('mousedown', this._onDocumentMouseDown.bind(this), false);\n\telement.addEventListener('mouseup', this._onDocumentMouseUp.bind(this), false);\n\telement.addEventListener('mousewheel', this._onMouseWheel.bind(this), false);\n\telement.addEventListener('DOMMouseScroll', this._onMouseWheel.bind(this), false); // firefox\n};\n\n// statics to describe the events we dispatch\nvg.MouseCaster.OVER = 'over';\nvg.MouseCaster.OUT = 'out';\nvg.MouseCaster.DOWN = 'down';\nvg.MouseCaster.UP = 'up';\nvg.MouseCaster.CLICK = 'click'; // only fires if the user clicked down and up while on the same object\nvg.MouseCaster.WHEEL = 'wheel';\n\nvg.MouseCaster.prototype = {\n\tupdate: function() {\n\t\tif (!this.active) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._raycaster.setFromCamera(this.screenPosition, this._camera);\n\n\t\tvar intersects = this._raycaster.intersectObject(this.group, true);\n\t\tvar hit, obj;\n\n\t\tconsole.log(intersects);\n\t\tif (intersects.length > 0) {\n\t\t\tconsole.log('intersects');\n\t\t\t// get the first object under the mouse\n\t\t\thit = intersects[0];\n\t\t\tobj = hit.object.userData.structure;\n\t\t\tconsole.log(obj);\n\t\t\tif (this.pickedObject != obj) {\n\t\t\t\t// the first object changed, meaning there's a different one, or none at all\n\t\t\t\tif (this.pickedObject) {\n\t\t\t\t\t// it's a new object, notify the old object is going away\n\t\t\t\t\tthis.signal.dispatch(vg.MouseCaster.OUT, this.pickedObject);\n\t\t\t\t}\n\t\t\t\t/*else {\n\t\t\t\t\t// hit a new object when nothing was there previously\n\t\t\t\t}*/\n\t\t\t\tthis.pickedObject = obj;\n\t\t\t\tthis.selectedObject = null; // cancel click, otherwise it'll confuse the user\n\n\t\t\t\tthis.signal.dispatch(vg.MouseCaster.OVER, this.pickedObject);\n\t\t\t}\n\t\t\tthis.position.copy(hit.point);\n\t\t\tthis.screenPosition.z = hit.distance;\n\t\t}\n\t\telse {\n\t\t\t// there isn't anything under the mouse\n\t\t\tif (this.pickedObject) {\n\t\t\t\t// there was though, we just moved out\n\t\t\t\tthis.signal.dispatch(vg.MouseCaster.OUT, this.pickedObject);\n\t\t\t}\n\t\t\tthis.pickedObject = null;\n\t\t\tthis.selectedObject = null;\n\t\t}\n\n\t\tthis.allHits = intersects;\n\t},\n\n\tpreventDefault: function() {\n\t\tthis._preventDefault = true;\n\t},\n\n\t_onDocumentMouseDown: function(evt) {\n\t\tevt = evt || window.event;\n\t\tevt.preventDefault();\n\t\tif (this._preventDefault) {\n\t\t\tthis._preventDefault = false;\n\t\t\treturn false;\n\t\t}\n\t\tif (this.pickedObject) {\n\t\t\tthis.selectedObject = this.pickedObject;\n\t\t}\n\t\tthis.shift = evt.shiftKey;\n\t\tthis.ctrl = evt.ctrlKey;\n\n\t\tthis.down = evt.which === 1;\n\t\tthis.rightDown = evt.which === 3;\n\n\t\tthis.signal.dispatch(vg.MouseCaster.DOWN, this.pickedObject);\n\t},\n\n\t_onDocumentMouseUp: function(evt) {\n\t\tevt.preventDefault();\n\t\tif (this._preventDefault) {\n\t\t\tthis._preventDefault = false;\n\t\t\treturn false;\n\t\t}\n\t\tthis.shift = evt.shiftKey;\n\t\tthis.ctrl = evt.ctrlKey;\n\n\t\tthis.signal.dispatch(vg.MouseCaster.UP, this.pickedObject);\n\t\tif (this.selectedObject && this.pickedObject && this.selectedObject.uniqueID === this.pickedObject.uniqueID) {\n\t\t\tthis.signal.dispatch(vg.MouseCaster.CLICK, this.pickedObject);\n\t\t}\n\n\t\tthis.down = evt.which === 1 ? false : this.down;\n\t\tthis.rightDown = evt.which === 3 ? false : this.rightDown;\n\t},\n\n\t_onDocumentMouseMove: function(evt) {\n\t\tevt.preventDefault();\n\t\tthis.screenPosition.x = (evt.clientX / window.innerWidth) * 2 - 1;\n\t\tthis.screenPosition.y = -(evt.clientY / window.innerHeight) * 2 + 1;\n\t},\n\n\t_onMouseWheel: function(evt) {\n\t\tif (!this.active) {\n\t\t\treturn;\n\t\t}\n\t\tevt.preventDefault();\n\t\tevt.stopPropagation();\n\n\t\tvar delta = 0;\n\t\tif (evt.wheelDelta !== undefined) { // WebKit / Opera / Explorer 9\n\t\t\tdelta = evt.wheelDelta;\n\t\t}\n\t\telse if (evt.detail !== undefined) { // Firefox\n\t\t\tdelta = -evt.detail;\n\t\t}\n\t\tif (delta > 0) {\n\t\t\tthis.wheel++;\n\t\t}\n\t\telse {\n\t\t\tthis.wheel--;\n\t\t}\n\t\t// console.log(this.wheel);\n\t\tthis.signal.dispatch(vg.MouseCaster.WHEEL, this.wheel);\n\t}\n};\n\nvg.MouseCaster.prototype.constructor = vg.MouseCaster;\n","/*\n\tSets up and manages a THREEjs container, camera, and light, making it easy to get going.\n\tAlso provides camera control.\n\n\tAssumes full screen.\n */\n// 'utils/Tools'\nvg.Scene = function(sceneConfig, controlConfig) {\n\tvar sceneSettings = {\n\t\telement: document.body,\n\t\talpha: true,\n\t\tantialias: true,\n\t\tclearColor: '#fff',\n\t\tsortObjects: false,\n\t\tfog: null,\n\t\tlight: new THREE.DirectionalLight(0xffffff),\n\t\tlightPosition: null,\n\t\tcameraType: 'PerspectiveCamera',\n\t\tcameraPosition: null, // {x, y, z}\n\t\torthoZoom: 4\n\t};\n\n\tvar controlSettings = {\n\t\tminDistance: 100,\n\t\tmaxDistance: 1000,\n\t\tzoomSpeed: 2,\n\t\tnoZoom: false\n\t};\n\n\tsceneSettings = vg.Tools.merge(sceneSettings, sceneConfig);\n\tif (typeof controlConfig !== 'boolean') {\n\t\tcontrolSettings = vg.Tools.merge(controlSettings, controlConfig);\n\t}\n\n\tthis.renderer = new THREE.WebGLRenderer({\n\t\talpha: sceneSettings.alpha,\n\t\tantialias: sceneSettings.antialias\n\t});\n\tthis.renderer.setClearColor(sceneSettings.clearColor, 0);\n\tthis.renderer.sortObjects = sceneSettings.sortObjects;\n\n\tthis.width = window.innerWidth;\n\tthis.height = window.innerHeight;\n\n\tthis.orthoZoom = sceneSettings.orthoZoom;\n\n\tthis.container = new THREE.Scene();\n\tthis.container.fog = sceneSettings.fog;\n\n\tthis.container.add(new THREE.AmbientLight(0xdddddd));\n\n\tif (!sceneSettings.lightPosition) {\n\t\tsceneSettings.light.position.set(-1, 1, -1).normalize();\n\t}\n\tthis.container.add(sceneSettings.light);\n\n\tif (sceneSettings.cameraType === 'OrthographicCamera') {\n\t\tvar width = window.innerWidth / this.orthoZoom;\n\t\tvar height = window.innerHeight / this.orthoZoom;\n\t\tthis.camera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, 1, 5000);\n\t}\n\telse {\n\t\tthis.camera = new THREE.PerspectiveCamera(50, this.width / this.height, 1, 5000);\n\t}\n\n\tthis.contolled = !!controlConfig;\n\tif (this.contolled) {\n\t\tthis.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);\n\t\tthis.controls.minDistance = controlSettings.minDistance;\n\t\tthis.controls.maxDistance = controlSettings.maxDistance;\n\t\tthis.controls.zoomSpeed = controlSettings.zoomSpeed;\n\t\tthis.controls.noZoom = controlSettings.noZoom;\n\t}\n\n\tif (sceneSettings.cameraPosition) {\n\t\tthis.camera.position.copy(sceneSettings.cameraPosition);\n\t}\n\n\twindow.addEventListener('resize', function onWindowResize() {\n\t\tthis.width = window.innerWidth;\n\t\tthis.height = window.innerHeight;\n\t\tif (this.camera.type === 'OrthographicCamera') {\n\t\t\tvar width = this.width / this.orthoZoom;\n\t\t\tvar height = this.height / this.orthoZoom;\n\t\t\tthis.camera.left = width / -2;\n\t\t\tthis.camera.right = width / 2;\n\t\t\tthis.camera.top = height / 2;\n\t\t\tthis.camera.bottom = height / -2;\n\t\t}\n\t\telse {\n\t\t\tthis.camera.aspect = this.width / this.height;\n\t\t}\n\t\tthis.camera.updateProjectionMatrix();\n\t\tthis.renderer.setSize(this.width, this.height);\n\t}.bind(this), false);\n\n\tthis.attachTo(sceneSettings.element);\n};\n\nvg.Scene.prototype = {\n\n\tattachTo: function(element) {\n\t\telement.style.width = this.width + 'px';\n\t\telement.style.height = this.height + 'px';\n\t\tthis.renderer.setPixelRatio(window.devicePixelRatio);\n\t\tthis.renderer.setSize(this.width, this.height);\n\t\telement.appendChild(this.renderer.domElement);\n\t},\n\n\tadd: function(mesh) {\n\t\tthis.container.add(mesh);\n\t},\n\n\tremove: function(mesh) {\n\t\tthis.container.remove(mesh);\n\t},\n\n\trender: function() {\n\t\tif (this.contolled) this.controls.update();\n\t\tthis.renderer.render(this.container, this.camera);\n\t},\n\n\tupdateOrthoZoom: function() {\n\t\tif (this.orthoZoom <= 0) {\n\t\t\tthis.orthoZoom = 0;\n\t\t\treturn;\n\t\t}\n\t\tvar width = this.width / this.orthoZoom;\n\t\tvar height = this.height / this.orthoZoom;\n\t\tthis.camera.left = width / -2;\n\t\tthis.camera.right = width / 2;\n\t\tthis.camera.top = height / 2;\n\t\tthis.camera.bottom = height / -2;\n\t\tthis.camera.updateProjectionMatrix();\n\t},\n\n\tfocusOn: function(obj) {\n\t\tthis.camera.lookAt(obj.position);\n\t}\n};\n\nvg.Scene.prototype.constructor = vg.Scene;\n","// 'utils/Tools', 'lib/LinkedList', 'utils/MouseCaster', 'lib/Signal'\nvg.SelectionManager = function(mouse) {\n\tthis.mouse = mouse;\n\n\tthis.onSelect = new vg.Signal();\n\tthis.onDeselect = new vg.Signal();\n\n\tthis.selected = null;\n\t// deselect if player clicked on the same thing twice\n\tthis.toggleSelection = false;\n\n\t// allow multiple entities to be selected at once\n\t// this.multiselect = false; // todo\n\t// this.allSelected = new LinkedList();\n\n\tthis.mouse.signal.add(this.onMouse, this);\n}\n\nvg.SelectionManager.prototype = {\n\tselect: function(obj, fireSignal) {\n\t\tif (!obj) return;\n\t\tfireSignal = fireSignal || true;\n\n\t\tif (this.selected !== obj) {\n\t\t\t// deselect previous object\n\t\t\tthis.clearSelection(fireSignal);\n\t\t}\n\t\tif (obj.selected) {\n\t\t\tif (this.toggleSelection) {\n\t\t\t\tif (fireSignal) {\n\t\t\t\t\tthis.onDeselect.dispatch(obj);\n\t\t\t\t}\n\t\t\t\tobj.deselect();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tobj.select();\n\t\t}\n\n\t\tthis.selected = obj;\n\t\tif (fireSignal) {\n\t\t\tthis.onSelect.dispatch(obj);\n\t\t}\n\t},\n\n\tclearSelection: function(fireSignal) {\n\t\tfireSignal = fireSignal || true;\n\t\tif (this.selected) {\n\t\t\tif (fireSignal) {\n\t\t\t\tthis.onDeselect.dispatch(this.selected);\n\t\t\t}\n\t\t\tthis.selected.deselect();\n\t\t}\n\t\tthis.selected = null;\n\t},\n\n\tonMouse: function(type, obj) {\n\t\tswitch (type) {\n\t\t\tcase vg.MouseCaster.DOWN:\n\t\t\t\tif (!obj) {\n\t\t\t\t\tthis.clearSelection();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase vg.MouseCaster.CLICK:\n\t\t\t\tthis.select(obj);\n\t\t\t\tbreak;\n\t\t}\n\t}\n};\n\nvg.SelectionManager.prototype.constructor = vg.SelectionManager;\n","vg.Tools = {\n\tclamp: function(val, min, max) {\n\t\treturn Math.max(min, Math.min(max, val));\n\t},\n\n\tsign: function(val) {\n\t\treturn val && val / Math.abs(val);\n\t},\n\n\t/**\n\t * If one value is passed, it will return something from -val to val.\n\t * Else it returns a value between the range specified by min, max.\n\t */\n\trandom: function(min, max) {\n\t\tif (arguments.length === 1) {\n\t\t\treturn (Math.random() * min) - (min * 0.5);\n\t\t}\n\t\treturn Math.random() * (max - min) + min;\n\t},\n\n\t// from min to (and including) max\n\trandomInt: function(min, max) {\n\t\tif (arguments.length === 1) {\n\t\t\treturn (Math.random() * min) - (min * 0.5) | 0;\n\t\t}\n\t\treturn (Math.random() * (max - min + 1) + min) | 0;\n\t},\n\n\tnormalize: function(v, min, max) {\n\t\treturn (v - min) / (max - min);\n\t},\n\n\tgetShortRotation: function(angle) {\n\t\tangle %= this.TAU;\n\t\tif (angle > this.PI) {\n\t\t\tangle -= this.TAU;\n\t\t}\n\t\telse if (angle < -this.PI) {\n\t\t\tangle += this.TAU;\n\t\t}\n\t\treturn angle;\n\t},\n\n\tgenerateID: function() {\n\t\treturn Math.random().toString(36).slice(2) + Date.now();\n\t},\n\n\tisPlainObject: function(obj) {\n\t\tif (typeof(obj) !== 'object' || obj.nodeType || obj === obj.window) {\n\t\t\treturn false;\n\t\t}\n\t\t// The try/catch suppresses exceptions thrown when attempting to access the 'constructor' property of certain host objects, ie. |window.location|\n\t\t// https://bugzilla.mozilla.org/show_bug.cgi?id=814622\n\t\ttry {\n\t\t\tif (obj.constructor && !Object.prototype.hasOwnProperty.call(obj.constructor.prototype, 'isPrototypeOf')) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tcatch (err) {\n\t\t\treturn false;\n\t\t}\n\t\t// If the function hasn't returned already, we're confident that\n\t\t// |obj| is a plain object, created by {} or constructed with new Object\n\t\treturn true;\n\t},\n\n\t// https://github.com/KyleAMathews/deepmerge/blob/master/index.js\n\tmerge: function(target, src) {\n\t\tvar self = this, array = Array.isArray(src);\n\t\tvar dst = array && [] || {};\n\t\tif (array) {\n\t\t\ttarget = target || [];\n\t\t\tdst = dst.concat(target);\n\t\t\tsrc.forEach(function(e, i) {\n\t\t\t\tif (typeof dst[i] === 'undefined') {\n\t\t\t\t\tdst[i] = e;\n\t\t\t\t}\n\t\t\t\telse if (self.isPlainObject(e)) {\n\t\t\t\t\tdst[i] = self.merge(target[i], e);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif (target.indexOf(e) === -1) {\n\t\t\t\t\t\tdst.push(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn dst;\n\t\t}\n\t\tif (target && self.isPlainObject(target)) {\n\t\t\tObject.keys(target).forEach(function (key) {\n\t\t\t\tdst[key] = target[key];\n\t\t\t});\n\t\t}\n\t\tObject.keys(src).forEach(function (key) {\n\t\t\tif (!src[key] || !self.isPlainObject(src[key])) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!target[key]) {\n\t\t\t\t\tdst[key] = src[key];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdst[key] = self.merge(target[key], src[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn dst;\n\t},\n\n\tnow: function() {\n\t\treturn window.nwf ? window.nwf.system.Performance.elapsedTime : window.performance.now();\n\t},\n\n\tempty: function(node) {\n\t\twhile (node.lastChild) {\n\t\t\tnode.removeChild(node.lastChild);\n\t\t}\n\t},\n\n\t/*\n\t\t@source: http://jsperf.com/radix-sort\n\t */\n\tradixSort: function(arr, idxBegin, idxEnd, bit) {\n\t\tidxBegin = idxBegin || 0;\n\t\tidxEnd = idxEnd || arr.length;\n\t\tbit = bit || 31;\n\t\tif (idxBegin >= (idxEnd - 1) || bit < 0) {\n\t\t\treturn;\n\t\t}\n\t\tvar idx = idxBegin;\n\t\tvar idxOnes = idxEnd;\n\t\tvar mask = 0x1 << bit;\n\t\twhile (idx < idxOnes) {\n\t\t\tif (arr[idx] & mask) {\n\t\t\t\t--idxOnes;\n\t\t\t\tvar tmp = arr[idx];\n\t\t\t\tarr[idx] = arr[idxOnes];\n\t\t\t\tarr[idxOnes] = tmp;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t++idx;\n\t\t\t}\n\t\t}\n\t\tthis.radixSort(arr, idxBegin, idxOnes, bit-1);\n\t\tthis.radixSort(arr, idxOnes, idxEnd, bit-1);\n\t},\n\n\trandomizeRGB: function(base, range) {\n\t\tvar rgb = base.split(',');\n\t\tvar color = 'rgb(';\n\t\tvar i, c;\n\t\trange = this.randomInt(range);\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\tc = parseInt(rgb[i]) + range;\n\t\t\tif (c < 0) c = 0;\n\t\t\telse if (c > 255) c = 255;\n\t\t\tcolor += c + ',';\n\t\t}\n\t\tcolor = color.substring(0, color.length-1);\n\t\tcolor += ')';\n\t\treturn color;\n\t},\n\n\tgetJSON: function(config) {\n\t\tvar xhr = new XMLHttpRequest();\n\t\tvar cache = typeof config.cache === 'undefined' ? false : config.cache;\n\t\tvar uri = cache ? config.url : config.url + '?t=' + Math.floor(Math.random() * 10000) + Date.now();\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (this.status === 200) {\n\t\t\t\tvar json = null;\n\t\t\t\ttry {\n\t\t\t\t\tjson = JSON.parse(this.responseText);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\t// console.warn('[Tools.getJSON] Error: '+config.url+' is not a json resource');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconfig.callback.call(config.scope || null, json);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (this.status !== 0) {\n\t\t\t\tconsole.warn('[Tools.getJSON] Error: '+this.status+' ('+this.statusText+') :: '+config.url);\n\t\t\t}\n\t\t}\n\t\txhr.open('GET', uri, true);\n\t\txhr.setRequestHeader('Accept', 'application/json');\n\t\txhr.setRequestHeader('Content-Type', 'application/json');\n\t\txhr.send('');\n\t}\n};\n","/*\n\tA* path-finder based upon http://www.redblobgames.com/pathfinding/a-star/introduction.html\n\t@author Corey Birnbaum https://github.com/vonWolfehaus/\n */\n// 'utils/Tools', 'lib/LinkedList'\nvg.AStarFinder = function(finderConfig) {\n\tfinderConfig = finderConfig || {};\n\n\tvar settings = {\n\t\tallowDiagonal: false,\n\t\theuristicFilter: null\n\t};\n\tsettings = vg.Tools.merge(settings, finderConfig);\n\n\tthis.allowDiagonal = settings.allowDiagonal;\n\tthis.heuristicFilter = settings.heuristicFilter;\n\n\tthis.list = new vg.LinkedList();\n};\n\nvg.AStarFinder.prototype = {\n\t/*\n\t\tFind and return the path.\n\t\t@return Array<Cell> The path, including both start and end positions. Null if it failed.\n\t */\n\tfindPath: function(startNode, endNode, heuristic, grid, maxDistance) {\n\t\tvar current, costSoFar, neighbors, n, i, l;\n\t\theuristic = heuristic || this.heuristicFilter;\n\t\t// clear old values from previous finding\n\t\tgrid.clearPath();\n\t\tthis.list.clear();\n\n\t\t// push the start current into the open list\n\t\tthis.list.add(startNode);\n\n\t\t// while the open list is not empty\n\t\twhile (this.list.length > 0) {\n\t\t\t// sort so lowest cost is first\n\t\t\tthis.list.sort(this.compare);\n\n\t\t\t// pop the position of current which has the minimum `_calcCost` value.\n\t\t\tcurrent = this.list.shift();\n\t\t\tcurrent._visited = true;\n\n\t\t\t// if reached the end position, construct the path and return it\n\t\t\tif (current === endNode) {\n\t\t\t\treturn vg.PathUtil.backtrace(endNode);\n\t\t\t}\n\n\t\t\t// cycle through each neighbor of the current current\n\t\t\tneighbors = grid.getNeighbors(current, this.allowDiagonal, heuristic);\n\t\t\tfor (i = 0, l = neighbors.length; i < l; i++) {\n\t\t\t\tn = neighbors[i];\n\n\t\t\t\tif (!n.walkable) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tcostSoFar = current._calcCost + grid.distance(current, n);\n\n\t\t\t\t// check if the neighbor has not been inspected yet, or can be reached with smaller cost from the current node\n\t\t\t\tif (!n._visited || costSoFar < n._calcCost) {\n\t\t\t\t\tn._visited = true;\n\t\t\t\t\tn._parent = current;\n\t\t\t\t\tn._calcCost = costSoFar;\n\t\t\t\t\t// console.log(n);\n\t\t\t\t\t// _priority is the most important property, since it makes the algorithm \"greedy\" and seek the goal.\n\t\t\t\t\t// otherwise it behaves like a brushfire/breadth-first\n\t\t\t\t\tn._priority = costSoFar + grid.distance(endNode, n);\n\n\t\t\t\t\tif (n._priority > maxDistance) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// check neighbor if it's the end current as well--often cuts steps by a significant amount\n\t\t\t\t\tif (n === endNode) {\n\t\t\t\t\t\treturn vg.PathUtil.backtrace(endNode);\n\t\t\t\t\t}\n\t\t\t\t\t// console.log(n);\n\t\t\t\t\tthis.list.add(n);\n\t\t\t\t}\n\t\t\t\t// console.log(this.list);\n\t\t\t} // end for each neighbor\n\t\t} // end while not open list empty\n\t\t// failed to find the path\n\t\treturn null;\n\t},\n\n\tcompare: function(nodeA, nodeB) {\n\t\treturn nodeA._priority - nodeB._priority;\n\t}\n};\n\nvg.AStarFinder.prototype.constructor = vg.AStarFinder;","/*\n\t@source https://github.com/qiao/PathFinding.js/\n*/\nvg.PathUtil = {\n\t/**\n\t * Backtrace according to the parent records and return the path.\n\t * (including both start and end nodes)\n\t * @param {Node} node End node\n\t * @return {Array.<Array.<number>>} the path\n\t */\n\tbacktrace: function(node) {\n\t\tvar path = [node];\n\t\twhile (node._parent) {\n\t\t\tnode = node._parent;\n\t\t\tpath.push(node);\n\t\t}\n\t\treturn path.reverse();\n\t},\n\n\t/**\n\t * Backtrace from start and end node, and return the path.\n\t * (including both start and end nodes)\n\t * @param {Node}\n\t * @param {Node}\n\t */\n\tbiBacktrace: function(nodeA, nodeB) {\n\t\tvar pathA = this.backtrace(nodeA),\n\t\t\tpathB = this.backtrace(nodeB);\n\t\treturn pathA.concat(pathB.reverse());\n\t},\n\n\t/**\n\t * Compute the length of the path.\n\t * @param {Array.<Array.<number>>} path The path\n\t * @return {number} The length of the path\n\t */\n\tpathLength: function(path) {\n\t\tvar i, sum = 0, a, b, dx, dy;\n\t\tfor (i = 1; i < path.length; ++i) {\n\t\t\ta = path[i - 1];\n\t\t\tb = path[i];\n\t\t\tdx = a[0] - b[0];\n\t\t\tdy = a[1] - b[1];\n\t\t\tsum += Math.sqrt(dx * dx + dy * dy);\n\t\t}\n\t\treturn sum;\n\t},\n\n\n\t/**\n\t * Given the start and end coordinates, return all the coordinates lying\n\t * on the line formed by these coordinates, based on Bresenham's algorithm.\n\t * http://en.wikipedia.org/wiki/Bresenham's_line_algorithm#Simplification\n\t * @param {number} x0 Start x coordinate\n\t * @param {number} y0 Start y coordinate\n\t * @param {number} x1 End x coordinate\n\t * @param {number} y1 End y coordinate\n\t * @return {Array.<Array.<number>>} The coordinates on the line\n\t */\n\tinterpolate: function(x0, y0, x1, y1) {\n\t\tvar abs = Math.abs,\n\t\t\tline = [],\n\t\t\tsx, sy, dx, dy, err, e2;\n\n\t\tdx = abs(x1 - x0);\n\t\tdy = abs(y1 - y0);\n\n\t\tsx = (x0 < x1) ? 1 : -1;\n\t\tsy = (y0 < y1) ? 1 : -1;\n\n\t\terr = dx - dy;\n\n\t\twhile (x0 !== x1 || y0 !== y1) {\n\t\t\tline.push([x0, y0]);\n\n\t\t\te2 = 2 * err;\n\t\t\tif (e2 > -dy) {\n\t\t\t\terr = err - dy;\n\t\t\t\tx0 = x0 + sx;\n\t\t\t}\n\t\t\tif (e2 < dx) {\n\t\t\t\terr = err + dx;\n\t\t\t\ty0 = y0 + sy;\n\t\t\t}\n\t\t}\n\n\t\treturn line;\n\t},\n\n\n\t/**\n\t * Given a compressed path, return a new path that has all the segments\n\t * in it interpolated.\n\t * @param {Array.<Array.<number>>} path The path\n\t * @return {Array.<Array.<number>>} expanded path\n\t */\n\texpandPath: function(path) {\n\t\tvar expanded = [],\n\t\t\tlen = path.length,\n\t\t\tcoord0, coord1,\n\t\t\tinterpolated,\n\t\t\tinterpolatedLen,\n\t\t\ti, j;\n\n\t\tif (len < 2) {\n\t\t\treturn expanded;\n\t\t}\n\n\t\tfor (i = 0; i < len - 1; ++i) {\n\t\t\tcoord0 = path[i];\n\t\t\tcoord1 = path[i + 1];\n\n\t\t\tinterpolated = this.interpolate(coord0[0], coord0[1], coord1[0], coord1[1]);\n\t\t\tinterpolatedLen = interpolated.length;\n\t\t\tfor (j = 0; j < interpolatedLen - 1; ++j) {\n\t\t\t\texpanded.push(interpolated[j]);\n\t\t\t}\n\t\t}\n\t\texpanded.push(path[len - 1]);\n\n\t\treturn expanded;\n\t},\n\n\n\t/**\n\t * Smoothen the give path.\n\t * The original path will not be modified; a new path will be returned.\n\t * @param {PF.Grid} grid\n\t * @param {Array.<Array.<number>>} path The path\n\t */\n\tsmoothenPath: function(grid, path) {\n\t\tvar len = path.length,\n\t\t\tx0 = path[0][0],        // path start x\n\t\t\ty0 = path[0][1],        // path start y\n\t\t\tx1 = path[len - 1][0],  // path end x\n\t\t\ty1 = path[len - 1][1],  // path end y\n\t\t\tsx, sy,                 // current start coordinate\n\t\t\tex, ey,                 // current end coordinate\n\t\t\tnewPath,\n\t\t\tlastValidCoord,\n\t\t\ti, j, coord, line, testCoord, blocked;\n\n\t\tsx = x0;\n\t\tsy = y0;\n\t\tnewPath = [[sx, sy]];\n\n\t\tfor (i = 2; i < len; ++i) {\n\t\t\tcoord = path[i];\n\t\t\tex = coord[0];\n\t\t\tey = coord[1];\n\t\t\tline = this.interpolate(sx, sy, ex, ey);\n\n\t\t\tblocked = false;\n\t\t\tfor (j = 1; j < line.length; ++j) {\n\t\t\t\ttestCoord = line[j];\n\n\t\t\t\tif (!grid.isWalkableAt(testCoord[0], testCoord[1])) {\n\t\t\t\t\tblocked = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (blocked) {\n\t\t\t\tlastValidCoord = path[i - 1];\n\t\t\t\tnewPath.push(lastValidCoord);\n\t\t\t\tsx = lastValidCoord[0];\n\t\t\t\tsy = lastValidCoord[1];\n\t\t\t}\n\t\t}\n\t\tnewPath.push([x1, y1]);\n\n\t\treturn newPath;\n\t},\n\n\n\t/**\n\t * Compress a path, remove redundant nodes without altering the shape\n\t * The original path is not modified\n\t * @param {Array.<Array.<number>>} path The path\n\t * @return {Array.<Array.<number>>} The compressed path\n\t */\n\tcompressPath: function(path) {\n\n\t\t// nothing to compress\n\t\tif (path.length < 3) {\n\t\t\treturn path;\n\t\t}\n\n\t\tvar compressed = [],\n\t\t\tsx = path[0][0], // start x\n\t\t\tsy = path[0][1], // start y\n\t\t\tpx = path[1][0], // second point x\n\t\t\tpy = path[1][1], // second point y\n\t\t\tdx = px - sx, // direction between the two points\n\t\t\tdy = py - sy, // direction between the two points\n\t\t\tlx, ly,\n\t\t\tldx, ldy,\n\t\t\tsq, i;\n\n\t\t// normalize the direction\n\t\tsq = Math.sqrt(dx*dx + dy*dy);\n\t\tdx /= sq;\n\t\tdy /= sq;\n\n\t\t// start the new path\n\t\tcompressed.push([sx,sy]);\n\n\t\tfor (i = 2; i < path.length; i++) {\n\n\t\t\t// store the last point\n\t\t\tlx = px;\n\t\t\tly = py;\n\n\t\t\t// store the last direction\n\t\t\tldx = dx;\n\t\t\tldy = dy;\n\n\t\t\t// next point\n\t\t\tpx = path[i][0];\n\t\t\tpy = path[i][1];\n\n\t\t\t// next direction\n\t\t\tdx = px - lx;\n\t\t\tdy = py - ly;\n\n\t\t\t// normalize\n\t\t\tsq = Math.sqrt(dx*dx + dy*dy);\n\t\t\tdx /= sq;\n\t\t\tdy /= sq;\n\n\t\t\t// if the direction has changed, store the point\n\t\t\tif (dx !== ldx || dy !== ldy) {\n\t\t\t\tcompressed.push([lx,ly]);\n\t\t\t}\n\t\t}\n\n\t\t// store the last point\n\t\tcompressed.push([px,py]);\n\n\t\treturn compressed;\n\t}\n};\n"]}